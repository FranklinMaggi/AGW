francescomaggi@MacBook-Pro agw-app % showall
├─ .wrangler/tmp/dev-dnyI08/api.js
```javascript
var __defProp = Object.defineProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });

// workers/core/cors.js
function cors(type = "application/json") {
  return {
    "Content-Type": type,
    "Access-Control-Allow-Origin": "*",
    "Access-Control-Allow-Methods": "GET,POST,OPTIONS",
    "Access-Control-Allow-Headers": "Content-Type, x-admin-token"
  };
}
__name(cors, "cors");

// workers/core/json.js
function json(data, status = 200) {
  return new Response(JSON.stringify(data), {
    status,
    headers: cors("application/json")
  });
}
__name(json, "json");

// workers/services/user.js
async function saveUser(env, id, user) {
  await env.AGW_USERS.put(`user:${id}`, JSON.stringify(user));
}
__name(saveUser, "saveUser");
async function getUser(env, id) {
  const raw = await env.AGW_USERS.get(`user:${id}`);
  return raw ? JSON.parse(raw) : null;
}
__name(getUser, "getUser");
async function findUserByEmail(env, email) {
  const norm = /* @__PURE__ */ __name((v) => (v || "").trim().toLowerCase(), "norm");
  const target = norm(email);
  if (!target) return null;
  const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
  for (const k of keys) {
    if (k.name === "user:index") continue;
    const raw = await env.AGW_USERS.get(k.name);
    if (!raw) continue;
    let user;
    try {
      user = JSON.parse(raw);
    } catch {
      continue;
    }
    if (norm(user.email) === target || norm(user.mailing?.primary) === target) {
      return user;
    }
  }
  return null;
}
__name(findUserByEmail, "findUserByEmail");

// workers/services/session.js
async function createSession(env, userId, role = "user") {
  const sessionId = crypto.randomUUID();
  const session = {
    sessionId,
    userId,
    role,
    createdAt: Date.now(),
    expiresAt: Date.now() + 1e3 * 60 * 60 * 24 * 30
    // 30 days
  };
  await env.AGW_SESSIONS.put(`sess:${sessionId}`, JSON.stringify(session));
  return session;
}
__name(createSession, "createSession");
async function verifySession(env, sessionId) {
  if (!sessionId) return null;
  const raw = await env.AGW_SESSIONS.get(`sess:${sessionId}`);
  if (!raw) return null;
  const session = JSON.parse(raw);
  if (session.expiresAt < Date.now()) {
    await env.AGW_SESSIONS.delete(`sess:${sessionId}`);
    return null;
  }
  return session;
}
__name(verifySession, "verifySession");
async function deleteSession(env, sessionId) {
  await env.AGW_SESSIONS.delete(`sess:${sessionId}`);
}
__name(deleteSession, "deleteSession");

// workers/utils/password.js
async function hashPassword(password) {
  const encoder = new TextEncoder();
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const keyMaterial = await crypto.subtle.importKey(
    "raw",
    encoder.encode(password),
    { name: "PBKDF2" },
    false,
    ["deriveBits", "deriveKey"]
  );
  const key = await crypto.subtle.deriveKey(
    {
      name: "PBKDF2",
      salt,
      iterations: 1e5,
      // Cloudflare MAX
      hash: "SHA-256"
    },
    keyMaterial,
    { name: "AES-GCM", length: 256 },
    true,
    ["encrypt", "decrypt"]
  );
  const rawKey = new Uint8Array(await crypto.subtle.exportKey("raw", key));
  return {
    hash: btoa(String.fromCharCode(...rawKey)),
    salt: btoa(String.fromCharCode(...salt))
  };
}
__name(hashPassword, "hashPassword");
async function verifyPassword(password, hash, salt) {
  const encoder = new TextEncoder();
  const saltBytes = Uint8Array.from(atob(salt), (c) => c.charCodeAt(0));
  const hashBytes = Uint8Array.from(atob(hash), (c) => c.charCodeAt(0));
  const keyMaterial = await crypto.subtle.importKey(
    "raw",
    encoder.encode(password),
    { name: "PBKDF2" },
    false,
    ["deriveBits", "deriveKey"]
  );
  const key = await crypto.subtle.deriveKey(
    {
      name: "PBKDF2",
      salt: saltBytes,
      iterations: 1e5,
      // Cloudflare MAX
      hash: "SHA-256"
    },
    keyMaterial,
    { name: "AES-GCM", length: 256 },
    true,
    ["encrypt", "decrypt"]
  );
  const rawKey = new Uint8Array(await crypto.subtle.exportKey("raw", key));
  return rawKey.every((b, i) => b === hashBytes[i]);
}
__name(verifyPassword, "verifyPassword");

// workers/routes/user.js
async function userRoutes(url, method, request, env) {
  if (url.pathname === "/api/user/login" && method === "POST") {
    const { email, password } = await request.json();
    const user = await findUserByEmail(env, email);
    if (!user) return json({ ok: false, error: "EMAIL_NOT_FOUND" }, 404);
    const ok = await verifyPassword(password, user.password_hash, user.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_PASSWORD" }, 401);
    const session = await createSession(env, user.id, "user");
    return json({ ok: true, sessionId: session.sessionId });
  }
  if (url.pathname.replace(/\/+$/, "") === "/api/user/register" && method === "POST") {
    const { email, password, firstname, lastname } = await request.json();
    const exists = await findUserByEmail(env, email);
    if (exists) return json({ ok: false, error: "EMAIL_EXISTS" }, 409);
    const id = crypto.randomUUID();
    const { hash, salt } = await hashPassword(password);
    const user = {
      id,
      email,
      firstname,
      lastname,
      mailing: { primary: email },
      password_hash: hash,
      password_salt: salt,
      status: { suspended: false, createdAt: Date.now() },
      stats: {}
    };
    await saveUser(env, id, user);
    return json({ ok: true });
  }
  if (url.pathname === "/api/user/get" && method === "POST") {
    const { userId } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/user/update-profile" && method === "POST") {
    const { userId, data } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    Object.assign(user, data);
    await saveUser(env, userId, user);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/user/update-password" && method === "POST") {
    const { userId, oldPassword, newPassword } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    const ok = await verifyPassword(oldPassword, user.password_hash, user.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_OLD_PASSWORD" }, 403);
    const { hash, salt } = await hashPassword(newPassword);
    user.password_hash = hash;
    user.password_salt = salt;
    await saveUser(env, userId, user);
    return json({ ok: true });
  }
  if (url.pathname === "/api/user/delete-account" && method === "POST") {
    const { userId } = await request.json();
    await env.AGW_USERS.delete(`user:${userId}`);
    return json({ ok: true });
  }
  if (url.pathname === "/api/user/update-email-prefs" && method === "POST") {
    const { userId, prefs } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    user.mailing = user.mailing || {};
    user.mailing.preferences = { ...user.mailing.preferences || {}, ...prefs };
    await saveUser(env, userId, user);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/user/update-avatar" && method === "POST") {
    const { userId, avatarBase64 } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    user.profile_image = avatarBase64;
    await saveUser(env, userId, user);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/user/request-reset" && method === "POST") {
    const { email } = await request.json();
    const user = await findUserByEmail(env, email);
    if (!user) return json({ ok: true });
    const token = crypto.randomUUID();
    user.resetToken = token;
    user.resetTokenExp = Date.now() + 1e3 * 60 * 10;
    await saveUser(env, user.id, user);
    return json({ ok: true, token });
  }
  if (url.pathname === "/api/user/do-reset" && method === "POST") {
    const { token, newPassword } = await request.json();
    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
    for (const k of keys) {
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;
      const user = JSON.parse(raw);
      if (user.resetToken === token && Date.now() < user.resetTokenExp) {
        const { hash, salt } = await hashPassword(newPassword);
        user.password_hash = hash;
        user.password_salt = salt;
        delete user.resetToken;
        delete user.resetTokenExp;
        await saveUser(env, user.id, user);
        return json({ ok: true });
      }
    }
    return json({ ok: false, error: "INVALID_OR_EXPIRED_TOKEN" }, 400);
  }
  if (url.pathname === "/api/user/logout" && method === "POST") {
    const { sessionId } = await request.json();
    await deleteSession(env, sessionId);
    return json({ ok: true });
  }
  if (url.pathname === "/api/user/change-password" && method === "POST") {
    const { userId, oldPassword, newPassword } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" });
    const ok = await verifyPassword(oldPassword, user.password_hash, user.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_OLD_PASSWORD" }, 403);
    const { hash, salt } = await hashPassword(newPassword);
    user.password_hash = hash;
    user.password_salt = salt;
    await saveUser(env, userId, user);
    return json({ ok: true });
  }
  return null;
}
__name(userRoutes, "userRoutes");

// workers/services/admin.js
function normalize(value) {
  return (value || "").trim().toLowerCase();
}
__name(normalize, "normalize");
async function getAdmin(env, email) {
  const target = normalize(email);
  const { keys } = await env.AGW_ADMIN.list({ prefix: "admin:" });
  for (const k of keys) {
    if (!k.name.startsWith("admin:")) continue;
    const raw = await env.AGW_ADMIN.get(k.name);
    if (!raw) continue;
    let admin;
    try {
      admin = JSON.parse(raw);
    } catch {
      continue;
    }
    if (normalize(admin.email) === target) {
      return admin;
    }
  }
  return null;
}
__name(getAdmin, "getAdmin");

// workers/routes/admin.js
async function adminRoutes(url, method, request, env) {
  if (url.pathname === "/api/admin/login" && method === "POST") {
    const { email, password } = await request.json();
    const admin = await getAdmin(env, email);
    if (!admin) return json({ ok: false, error: "ADMIN_NOT_FOUND" }, 404);
    const ok = await verifyPassword(password, admin.password_hash, admin.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_PASSWORD" }, 401);
    const session = await createSession(env, admin.id, "admin");
    return json({ ok: true, sessionId: session.sessionId });
  }
  if (url.pathname === "/api/admin/me" && method === "POST") {
    const { sessionId } = await request.json();
    const session = await verifySession(env, sessionId);
    return json({ ok: !!session });
  }
  if (url.pathname === "/api/admin/overview" && method === "POST") {
    const { sessionId } = await request.json();
    const session = await verifySession(env, sessionId);
    if (!session) return json({ ok: false, error: "UNAUTHORIZED" }, 403);
    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
    let totalUsers = 0;
    let activeSubs = 0;
    for (const k of keys) {
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;
      try {
        const user = JSON.parse(raw);
        if (user.id) totalUsers++;
        if (user.subscription?.type) activeSubs++;
      } catch {
      }
    }
    return json({ ok: true, totalUsers, activeSubs });
  }
  if (url.pathname === "/api/admin/users/list" && method === "GET") {
    const sessionId = url.searchParams.get("sessionId");
    const session = await verifySession(env, sessionId);
    if (!session) return json({ ok: false, error: "UNAUTHORIZED" }, 403);
    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
    const users = [];
    for (const k of keys) {
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;
      try {
        const user = JSON.parse(raw);
        users.push(user);
      } catch {
      }
    }
    return json({ ok: true, users });
  }
  if (url.pathname === "/api/admin/user/update" && method === "POST") {
    const { sessionId, id, field, value } = await request.json();
    const session = await verifySession(env, sessionId);
    if (!session) return json({ ok: false, error: "UNAUTHORIZED" }, 403);
    const user = await getUser(env, id);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    if (field === "delete") {
      await env.AGW_USERS.delete(`user:${id}`);
      return json({ ok: true, deleted: true });
    }
    user[field] = value;
    await saveUser(env, id, user);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/admin/user/save" && method === "POST") {
    const { sessionId, user } = await request.json();
    const session = await verifySession(env, sessionId);
    if (!session || session.role !== "admin") {
      return json({ ok: false, error: "UNAUTHORIZED" }, 403);
    }
    await saveUser(env, user.id, user);
    return json({ ok: true });
  }
  if (url.pathname === "/api/admin/bootstrap" && method === "POST") {
    const { token, email, password } = await request.json();
    if (token !== env.ADMIN_TOKEN) {
      return json({ ok: false, error: "FORBIDDEN" }, 403);
    }
    const existing = await getAdmin(env, email);
    if (existing) {
      return json({ ok: false, error: "ADMIN_ALREADY_EXISTS" }, 409);
    }
    const { hash, salt } = await hashPassword(password);
    const admin = {
      id: crypto.randomUUID(),
      email,
      password_hash: hash,
      password_salt: salt,
      role: "admin",
      createdAt: Date.now()
    };
    await env.AGW_ADMIN.put(`admin:${admin.id}`, JSON.stringify(admin));
    return json({ ok: true, admin });
  }
  return null;
}
__name(adminRoutes, "adminRoutes");

// workers/api.js
var api_default = {
  async fetch(request, env) {
    const url = new URL(request.url);
    const method = request.method;
    if (method === "OPTIONS") {
      return new Response(null, { status: 204, headers: cors() });
    }
    const u = await userRoutes(url, method, request, env);
    if (u) return u;
    const a = await adminRoutes(url, method, request, env);
    if (a) return a;
    return json({ ok: false, error: "NOT_FOUND" }, 404);
  }
};

// ../../../../../.nvm/versions/node/v22.18.0/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts
var drainBody = /* @__PURE__ */ __name(async (request, env, _ctx, middlewareCtx) => {
  try {
    return await middlewareCtx.next(request, env);
  } finally {
    try {
      if (request.body !== null && !request.bodyUsed) {
        const reader = request.body.getReader();
        while (!(await reader.read()).done) {
        }
      }
    } catch (e) {
      console.error("Failed to drain the unused request body.", e);
    }
  }
}, "drainBody");
var middleware_ensure_req_body_drained_default = drainBody;

// ../../../../../.nvm/versions/node/v22.18.0/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts
function reduceError(e) {
  return {
    name: e?.name,
    message: e?.message ?? String(e),
    stack: e?.stack,
    cause: e?.cause === void 0 ? void 0 : reduceError(e.cause)
  };
}
__name(reduceError, "reduceError");
var jsonError = /* @__PURE__ */ __name(async (request, env, _ctx, middlewareCtx) => {
  try {
    return await middlewareCtx.next(request, env);
  } catch (e) {
    const error = reduceError(e);
    return Response.json(error, {
      status: 500,
      headers: { "MF-Experimental-Error-Stack": "true" }
    });
  }
}, "jsonError");
var middleware_miniflare3_json_error_default = jsonError;

// .wrangler/tmp/bundle-0lA0fV/middleware-insertion-facade.js
var __INTERNAL_WRANGLER_MIDDLEWARE__ = [
  middleware_ensure_req_body_drained_default,
  middleware_miniflare3_json_error_default
];
var middleware_insertion_facade_default = api_default;

// ../../../../../.nvm/versions/node/v22.18.0/lib/node_modules/wrangler/templates/middleware/common.ts
var __facade_middleware__ = [];
function __facade_register__(...args) {
  __facade_middleware__.push(...args.flat());
}
__name(__facade_register__, "__facade_register__");
function __facade_invokeChain__(request, env, ctx, dispatch, middlewareChain) {
  const [head, ...tail] = middlewareChain;
  const middlewareCtx = {
    dispatch,
    next(newRequest, newEnv) {
      return __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);
    }
  };
  return head(request, env, ctx, middlewareCtx);
}
__name(__facade_invokeChain__, "__facade_invokeChain__");
function __facade_invoke__(request, env, ctx, dispatch, finalMiddleware) {
  return __facade_invokeChain__(request, env, ctx, dispatch, [
    ...__facade_middleware__,
    finalMiddleware
  ]);
}
__name(__facade_invoke__, "__facade_invoke__");

// .wrangler/tmp/bundle-0lA0fV/middleware-loader.entry.ts
var __Facade_ScheduledController__ = class ___Facade_ScheduledController__ {
  constructor(scheduledTime, cron, noRetry) {
    this.scheduledTime = scheduledTime;
    this.cron = cron;
    this.#noRetry = noRetry;
  }
  static {
    __name(this, "__Facade_ScheduledController__");
  }
  #noRetry;
  noRetry() {
    if (!(this instanceof ___Facade_ScheduledController__)) {
      throw new TypeError("Illegal invocation");
    }
    this.#noRetry();
  }
};
function wrapExportedHandler(worker) {
  if (__INTERNAL_WRANGLER_MIDDLEWARE__ === void 0 || __INTERNAL_WRANGLER_MIDDLEWARE__.length === 0) {
    return worker;
  }
  for (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {
    __facade_register__(middleware);
  }
  const fetchDispatcher = /* @__PURE__ */ __name(function(request, env, ctx) {
    if (worker.fetch === void 0) {
      throw new Error("Handler does not export a fetch() function.");
    }
    return worker.fetch(request, env, ctx);
  }, "fetchDispatcher");
  return {
    ...worker,
    fetch(request, env, ctx) {
      const dispatcher = /* @__PURE__ */ __name(function(type, init) {
        if (type === "scheduled" && worker.scheduled !== void 0) {
          const controller = new __Facade_ScheduledController__(
            Date.now(),
            init.cron ?? "",
            () => {
            }
          );
          return worker.scheduled(controller, env, ctx);
        }
      }, "dispatcher");
      return __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);
    }
  };
}
__name(wrapExportedHandler, "wrapExportedHandler");
function wrapWorkerEntrypoint(klass) {
  if (__INTERNAL_WRANGLER_MIDDLEWARE__ === void 0 || __INTERNAL_WRANGLER_MIDDLEWARE__.length === 0) {
    return klass;
  }
  for (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {
    __facade_register__(middleware);
  }
  return class extends klass {
    #fetchDispatcher = /* @__PURE__ */ __name((request, env, ctx) => {
      this.env = env;
      this.ctx = ctx;
      if (super.fetch === void 0) {
        throw new Error("Entrypoint class does not define a fetch() function.");
      }
      return super.fetch(request);
    }, "#fetchDispatcher");
    #dispatcher = /* @__PURE__ */ __name((type, init) => {
      if (type === "scheduled" && super.scheduled !== void 0) {
        const controller = new __Facade_ScheduledController__(
          Date.now(),
          init.cron ?? "",
          () => {
          }
        );
        return super.scheduled(controller);
      }
    }, "#dispatcher");
    fetch(request) {
      return __facade_invoke__(
        request,
        this.env,
        this.ctx,
        this.#dispatcher,
        this.#fetchDispatcher
      );
    }
  };
}
__name(wrapWorkerEntrypoint, "wrapWorkerEntrypoint");
var WRAPPED_ENTRY;
if (typeof middleware_insertion_facade_default === "object") {
  WRAPPED_ENTRY = wrapExportedHandler(middleware_insertion_facade_default);
} else if (typeof middleware_insertion_facade_default === "function") {
  WRAPPED_ENTRY = wrapWorkerEntrypoint(middleware_insertion_facade_default);
}
var middleware_loader_entry_default = WRAPPED_ENTRY;
export {
  __INTERNAL_WRANGLER_MIDDLEWARE__,
  middleware_loader_entry_default as default
};
//# sourceMappingURL=api.js.map
```

├─ .wrangler/tmp/dev-yZSyPY/api.js
```javascript
var __defProp = Object.defineProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });

// workers/core/cors.js
function cors(type = "application/json") {
  return {
    "Content-Type": type,
    "Access-Control-Allow-Origin": "*",
    "Access-Control-Allow-Methods": "GET,POST,OPTIONS",
    "Access-Control-Allow-Headers": "Content-Type, x-admin-token"
  };
}
__name(cors, "cors");

// workers/core/json.js
function json(data, status = 200) {
  return new Response(JSON.stringify(data), {
    status,
    headers: cors("application/json")
  });
}
__name(json, "json");

// workers/services/user.js
async function saveUser(env, id, user) {
  await env.AGW_USERS.put(`user:${id}`, JSON.stringify(user));
}
__name(saveUser, "saveUser");
async function getUser(env, id) {
  const raw = await env.AGW_USERS.get(`user:${id}`);
  return raw ? JSON.parse(raw) : null;
}
__name(getUser, "getUser");
async function findUserByEmail(env, email) {
  const norm = /* @__PURE__ */ __name((v) => (v || "").trim().toLowerCase(), "norm");
  const target = norm(email);
  if (!target) return null;
  const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
  for (const k of keys) {
    if (k.name === "user:index") continue;
    const raw = await env.AGW_USERS.get(k.name);
    if (!raw) continue;
    let user;
    try {
      user = JSON.parse(raw);
    } catch {
      continue;
    }
    if (norm(user.email) === target || norm(user.mailing?.primary) === target) {
      return user;
    }
  }
  return null;
}
__name(findUserByEmail, "findUserByEmail");

// workers/services/session.js
async function createSession(env, userId, role = "user") {
  const sessionId = crypto.randomUUID();
  const session = {
    sessionId,
    userId,
    role,
    createdAt: Date.now(),
    expiresAt: Date.now() + 1e3 * 60 * 60 * 24 * 30
    // 30 days
  };
  await env.AGW_SESSIONS.put(`sess:${sessionId}`, JSON.stringify(session));
  return session;
}
__name(createSession, "createSession");
async function verifySession(env, sessionId) {
  if (!sessionId) return null;
  const raw = await env.AGW_SESSIONS.get(`sess:${sessionId}`);
  if (!raw) return null;
  const session = JSON.parse(raw);
  if (session.expiresAt < Date.now()) {
    await env.AGW_SESSIONS.delete(`sess:${sessionId}`);
    return null;
  }
  return session;
}
__name(verifySession, "verifySession");
async function deleteSession(env, sessionId) {
  await env.AGW_SESSIONS.delete(`sess:${sessionId}`);
}
__name(deleteSession, "deleteSession");

// workers/utils/password.js
async function hashPassword(password) {
  const encoder = new TextEncoder();
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const keyMaterial = await crypto.subtle.importKey(
    "raw",
    encoder.encode(password),
    { name: "PBKDF2" },
    false,
    ["deriveBits", "deriveKey"]
  );
  const key = await crypto.subtle.deriveKey(
    {
      name: "PBKDF2",
      salt,
      iterations: 1e5,
      // Cloudflare MAX
      hash: "SHA-256"
    },
    keyMaterial,
    { name: "AES-GCM", length: 256 },
    true,
    ["encrypt", "decrypt"]
  );
  const rawKey = new Uint8Array(await crypto.subtle.exportKey("raw", key));
  return {
    hash: btoa(String.fromCharCode(...rawKey)),
    salt: btoa(String.fromCharCode(...salt))
  };
}
__name(hashPassword, "hashPassword");
async function verifyPassword(password, hash, salt) {
  const encoder = new TextEncoder();
  const saltBytes = Uint8Array.from(atob(salt), (c) => c.charCodeAt(0));
  const hashBytes = Uint8Array.from(atob(hash), (c) => c.charCodeAt(0));
  const keyMaterial = await crypto.subtle.importKey(
    "raw",
    encoder.encode(password),
    { name: "PBKDF2" },
    false,
    ["deriveBits", "deriveKey"]
  );
  const key = await crypto.subtle.deriveKey(
    {
      name: "PBKDF2",
      salt: saltBytes,
      iterations: 1e5,
      // Cloudflare MAX
      hash: "SHA-256"
    },
    keyMaterial,
    { name: "AES-GCM", length: 256 },
    true,
    ["encrypt", "decrypt"]
  );
  const rawKey = new Uint8Array(await crypto.subtle.exportKey("raw", key));
  return rawKey.every((b, i) => b === hashBytes[i]);
}
__name(verifyPassword, "verifyPassword");

// workers/routes/user.js
async function userRoutes(url, method, request, env) {
  if (url.pathname === "/api/user/login" && method === "POST") {
    const { email, password } = await request.json();
    const user = await findUserByEmail(env, email);
    if (!user) return json({ ok: false, error: "EMAIL_NOT_FOUND" }, 404);
    const ok = await verifyPassword(password, user.password_hash, user.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_PASSWORD" }, 401);
    const session = await createSession(env, user.id, "user");
    return json({ ok: true, sessionId: session.sessionId });
  }
  if (url.pathname.replace(/\/+$/, "") === "/api/user/register" && method === "POST") {
    const { email, password, firstname, lastname } = await request.json();
    const exists = await findUserByEmail(env, email);
    if (exists) return json({ ok: false, error: "EMAIL_EXISTS" }, 409);
    const id = crypto.randomUUID();
    const { hash, salt } = await hashPassword(password);
    const user = {
      id,
      email,
      firstname,
      lastname,
      mailing: { primary: email },
      password_hash: hash,
      password_salt: salt,
      status: { suspended: false, createdAt: Date.now() },
      stats: {}
    };
    await saveUser(env, id, user);
    return json({ ok: true });
  }
  if (url.pathname === "/api/user/get" && method === "POST") {
    const { userId } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/user/update-profile" && method === "POST") {
    const { userId, data } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    Object.assign(user, data);
    await saveUser(env, userId, user);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/user/update-password" && method === "POST") {
    const { userId, oldPassword, newPassword } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    const ok = await verifyPassword(oldPassword, user.password_hash, user.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_OLD_PASSWORD" }, 403);
    const { hash, salt } = await hashPassword(newPassword);
    user.password_hash = hash;
    user.password_salt = salt;
    await saveUser(env, userId, user);
    return json({ ok: true });
  }
  if (url.pathname === "/api/user/delete-account" && method === "POST") {
    const { userId } = await request.json();
    await env.AGW_USERS.delete(`user:${userId}`);
    return json({ ok: true });
  }
  if (url.pathname === "/api/user/update-email-prefs" && method === "POST") {
    const { userId, prefs } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    user.mailing = user.mailing || {};
    user.mailing.preferences = { ...user.mailing.preferences || {}, ...prefs };
    await saveUser(env, userId, user);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/user/update-avatar" && method === "POST") {
    const { userId, avatarBase64 } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    user.profile_image = avatarBase64;
    await saveUser(env, userId, user);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/user/request-reset" && method === "POST") {
    const { email } = await request.json();
    const user = await findUserByEmail(env, email);
    if (!user) return json({ ok: true });
    const token = crypto.randomUUID();
    user.resetToken = token;
    user.resetTokenExp = Date.now() + 1e3 * 60 * 10;
    await saveUser(env, user.id, user);
    return json({ ok: true, token });
  }
  if (url.pathname === "/api/user/do-reset" && method === "POST") {
    const { token, newPassword } = await request.json();
    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
    for (const k of keys) {
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;
      const user = JSON.parse(raw);
      if (user.resetToken === token && Date.now() < user.resetTokenExp) {
        const { hash, salt } = await hashPassword(newPassword);
        user.password_hash = hash;
        user.password_salt = salt;
        delete user.resetToken;
        delete user.resetTokenExp;
        await saveUser(env, user.id, user);
        return json({ ok: true });
      }
    }
    return json({ ok: false, error: "INVALID_OR_EXPIRED_TOKEN" }, 400);
  }
  if (url.pathname === "/api/user/logout" && method === "POST") {
    const { sessionId } = await request.json();
    await deleteSession(env, sessionId);
    return json({ ok: true });
  }
  if (url.pathname === "/api/user/change-password" && method === "POST") {
    const { userId, oldPassword, newPassword } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" });
    const ok = await verifyPassword(oldPassword, user.password_hash, user.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_OLD_PASSWORD" }, 403);
    const { hash, salt } = await hashPassword(newPassword);
    user.password_hash = hash;
    user.password_salt = salt;
    await saveUser(env, userId, user);
    return json({ ok: true });
  }
  return null;
}
__name(userRoutes, "userRoutes");

// workers/services/admin.js
function normalize(value) {
  return (value || "").trim().toLowerCase();
}
__name(normalize, "normalize");
async function getAdmin(env, email) {
  const target = normalize(email);
  const { keys } = await env.AGW_ADMIN.list({ prefix: "admin:" });
  for (const k of keys) {
    if (!k.name.startsWith("admin:")) continue;
    const raw = await env.AGW_ADMIN.get(k.name);
    if (!raw) continue;
    let admin;
    try {
      admin = JSON.parse(raw);
    } catch {
      continue;
    }
    if (normalize(admin.email) === target) {
      return admin;
    }
  }
  return null;
}
__name(getAdmin, "getAdmin");

// workers/routes/admin.js
async function adminRoutes(url, method, request, env) {
  if (url.pathname === "/api/admin/login" && method === "POST") {
    const { email, password } = await request.json();
    const admin = await getAdmin(env, email);
    if (!admin) return json({ ok: false, error: "ADMIN_NOT_FOUND" }, 404);
    const ok = await verifyPassword(password, admin.password_hash, admin.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_PASSWORD" }, 401);
    const session = await createSession(env, admin.id, "admin");
    return json({ ok: true, sessionId: session.sessionId });
  }
  if (url.pathname === "/api/admin/me" && method === "POST") {
    const { sessionId } = await request.json();
    const session = await verifySession(env, sessionId);
    return json({ ok: !!session });
  }
  if (url.pathname === "/api/admin/overview" && method === "POST") {
    const { sessionId } = await request.json();
    const session = await verifySession(env, sessionId);
    if (!session) return json({ ok: false, error: "UNAUTHORIZED" }, 403);
    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
    let totalUsers = 0;
    let activeSubs = 0;
    for (const k of keys) {
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;
      try {
        const user = JSON.parse(raw);
        if (user.id) totalUsers++;
        if (user.subscription?.type) activeSubs++;
      } catch {
      }
    }
    return json({ ok: true, totalUsers, activeSubs });
  }
  if (url.pathname === "/api/admin/users/list" && method === "GET") {
    const sessionId = url.searchParams.get("sessionId");
    const session = await verifySession(env, sessionId);
    if (!session) return json({ ok: false, error: "UNAUTHORIZED" }, 403);
    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
    const users = [];
    for (const k of keys) {
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;
      try {
        const user = JSON.parse(raw);
        users.push(user);
      } catch {
      }
    }
    return json({ ok: true, users });
  }
  if (url.pathname === "/api/admin/user/update" && method === "POST") {
    const { sessionId, id, field, value } = await request.json();
    const session = await verifySession(env, sessionId);
    if (!session) return json({ ok: false, error: "UNAUTHORIZED" }, 403);
    const user = await getUser(env, id);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    if (field === "delete") {
      await env.AGW_USERS.delete(`user:${id}`);
      return json({ ok: true, deleted: true });
    }
    user[field] = value;
    await saveUser(env, id, user);
    return json({ ok: true, user });
  }
  if (url.pathname === "/api/admin/user/save" && method === "POST") {
    const { sessionId, user } = await request.json();
    const session = await verifySession(env, sessionId);
    if (!session || session.role !== "admin") {
      return json({ ok: false, error: "UNAUTHORIZED" }, 403);
    }
    await saveUser(env, user.id, user);
    return json({ ok: true });
  }
  if (url.pathname === "/api/admin/bootstrap" && method === "POST") {
    const { token, email, password } = await request.json();
    if (token !== env.ADMIN_TOKEN) {
      return json({ ok: false, error: "FORBIDDEN" }, 403);
    }
    const existing = await getAdmin(env, email);
    if (existing) {
      return json({ ok: false, error: "ADMIN_ALREADY_EXISTS" }, 409);
    }
    const { hash, salt } = await hashPassword(password);
    const admin = {
      id: crypto.randomUUID(),
      email,
      password_hash: hash,
      password_salt: salt,
      role: "admin",
      createdAt: Date.now()
    };
    await env.AGW_ADMIN.put(`admin:${admin.id}`, JSON.stringify(admin));
    return json({ ok: true, admin });
  }
  return null;
}
__name(adminRoutes, "adminRoutes");

// workers/api.js
var api_default = {
  async fetch(request, env) {
    const url = new URL(request.url);
    const method = request.method;
    if (method === "OPTIONS") {
      return new Response(null, { status: 204, headers: cors() });
    }
    const u = await userRoutes(url, method, request, env);
    if (u) return u;
    const a = await adminRoutes(url, method, request, env);
    if (a) return a;
    return json({ ok: false, error: "NOT_FOUND" }, 404);
  }
};

// ../../../../../.nvm/versions/node/v22.18.0/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts
var drainBody = /* @__PURE__ */ __name(async (request, env, _ctx, middlewareCtx) => {
  try {
    return await middlewareCtx.next(request, env);
  } finally {
    try {
      if (request.body !== null && !request.bodyUsed) {
        const reader = request.body.getReader();
        while (!(await reader.read()).done) {
        }
      }
    } catch (e) {
      console.error("Failed to drain the unused request body.", e);
    }
  }
}, "drainBody");
var middleware_ensure_req_body_drained_default = drainBody;

// .wrangler/tmp/bundle-0wF48D/middleware-insertion-facade.js
var __INTERNAL_WRANGLER_MIDDLEWARE__ = [
  middleware_ensure_req_body_drained_default
];
var middleware_insertion_facade_default = api_default;

// ../../../../../.nvm/versions/node/v22.18.0/lib/node_modules/wrangler/templates/middleware/common.ts
var __facade_middleware__ = [];
function __facade_register__(...args) {
  __facade_middleware__.push(...args.flat());
}
__name(__facade_register__, "__facade_register__");
function __facade_invokeChain__(request, env, ctx, dispatch, middlewareChain) {
  const [head, ...tail] = middlewareChain;
  const middlewareCtx = {
    dispatch,
    next(newRequest, newEnv) {
      return __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);
    }
  };
  return head(request, env, ctx, middlewareCtx);
}
__name(__facade_invokeChain__, "__facade_invokeChain__");
function __facade_invoke__(request, env, ctx, dispatch, finalMiddleware) {
  return __facade_invokeChain__(request, env, ctx, dispatch, [
    ...__facade_middleware__,
    finalMiddleware
  ]);
}
__name(__facade_invoke__, "__facade_invoke__");

// .wrangler/tmp/bundle-0wF48D/middleware-loader.entry.ts
var __Facade_ScheduledController__ = class ___Facade_ScheduledController__ {
  constructor(scheduledTime, cron, noRetry) {
    this.scheduledTime = scheduledTime;
    this.cron = cron;
    this.#noRetry = noRetry;
  }
  static {
    __name(this, "__Facade_ScheduledController__");
  }
  #noRetry;
  noRetry() {
    if (!(this instanceof ___Facade_ScheduledController__)) {
      throw new TypeError("Illegal invocation");
    }
    this.#noRetry();
  }
};
function wrapExportedHandler(worker) {
  if (__INTERNAL_WRANGLER_MIDDLEWARE__ === void 0 || __INTERNAL_WRANGLER_MIDDLEWARE__.length === 0) {
    return worker;
  }
  for (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {
    __facade_register__(middleware);
  }
  const fetchDispatcher = /* @__PURE__ */ __name(function(request, env, ctx) {
    if (worker.fetch === void 0) {
      throw new Error("Handler does not export a fetch() function.");
    }
    return worker.fetch(request, env, ctx);
  }, "fetchDispatcher");
  return {
    ...worker,
    fetch(request, env, ctx) {
      const dispatcher = /* @__PURE__ */ __name(function(type, init) {
        if (type === "scheduled" && worker.scheduled !== void 0) {
          const controller = new __Facade_ScheduledController__(
            Date.now(),
            init.cron ?? "",
            () => {
            }
          );
          return worker.scheduled(controller, env, ctx);
        }
      }, "dispatcher");
      return __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);
    }
  };
}
__name(wrapExportedHandler, "wrapExportedHandler");
function wrapWorkerEntrypoint(klass) {
  if (__INTERNAL_WRANGLER_MIDDLEWARE__ === void 0 || __INTERNAL_WRANGLER_MIDDLEWARE__.length === 0) {
    return klass;
  }
  for (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {
    __facade_register__(middleware);
  }
  return class extends klass {
    #fetchDispatcher = /* @__PURE__ */ __name((request, env, ctx) => {
      this.env = env;
      this.ctx = ctx;
      if (super.fetch === void 0) {
        throw new Error("Entrypoint class does not define a fetch() function.");
      }
      return super.fetch(request);
    }, "#fetchDispatcher");
    #dispatcher = /* @__PURE__ */ __name((type, init) => {
      if (type === "scheduled" && super.scheduled !== void 0) {
        const controller = new __Facade_ScheduledController__(
          Date.now(),
          init.cron ?? "",
          () => {
          }
        );
        return super.scheduled(controller);
      }
    }, "#dispatcher");
    fetch(request) {
      return __facade_invoke__(
        request,
        this.env,
        this.ctx,
        this.#dispatcher,
        this.#fetchDispatcher
      );
    }
  };
}
__name(wrapWorkerEntrypoint, "wrapWorkerEntrypoint");
var WRAPPED_ENTRY;
if (typeof middleware_insertion_facade_default === "object") {
  WRAPPED_ENTRY = wrapExportedHandler(middleware_insertion_facade_default);
} else if (typeof middleware_insertion_facade_default === "function") {
  WRAPPED_ENTRY = wrapWorkerEntrypoint(middleware_insertion_facade_default);
}
var middleware_loader_entry_default = WRAPPED_ENTRY;
export {
  __INTERNAL_WRANGLER_MIDDLEWARE__,
  middleware_loader_entry_default as default
};
//# sourceMappingURL=api.js.map
```

├─ admin.json
```json
{
    "id": "admin-info",
    "email": "info@webonday.it",
    "password_hash": "pPk4vvHoYf8YJpWCivOi6Yjdm1DO5XxA48UkUmq/T50=",
    "password_salt": "cJSplbvtj7geFqCTQ9IzTg==",
    "role": "admin",
    "createdAt": 1732795600
  }
  ```

├─ app/admin/analytics/page.tsx
```
//admin/analytics/page.tsx
"use client";

import { Suspense } from "react";
import { useSearchParams } from "next/navigation";

export default function AnalyticsWrapper() {
  return (
    <Suspense fallback={<p className="admin-muted p-6">Caricamento...</p>}>
      <AnalyticsPage />
    </Suspense>
  );
}

function AnalyticsPage() {

  return (
    <div className="space-y-6">
      <h1 className="text-2xl admin-title">Analitiche Avanzate</h1>

      <div className="admin-card space-y-3">
        <p className="admin-muted">Statistiche e trend della piattaforma:</p>

        <ul className="admin-muted list-disc pl-4">
          <li>Crescita utenti</li>
          <li>Retention settimanale / mensile</li>
          <li>Day acquistati nel tempo</li>
          <li>Missioni completate</li>
          <li>Andamento KRM</li>
        </ul>
      </div>
    </div>
  );
}
```

├─ app/admin/components/AdminSidebar.tsx
```
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import {
  LayoutDashboard,
  Users,
  BadgeCheck,
  Target,
  BarChart3,
  Settings,
} from "lucide-react";

export default function AdminSidebar() {
  const pathname = usePathname();

  const items = [
    { label: "Overview", path: "/admin", icon: LayoutDashboard },
    { label: "Users", path: "/admin/users", icon: Users },
    { label: "Subscriptions", path: "/admin/subscriptions", icon: BadgeCheck },
    { label: "Missions", path: "/admin/missions", icon: Target },
    { label: "Analytics", path: "/admin/analytics", icon: BarChart3 },
    { label: "System", path: "/admin/system", icon: Settings },
  ];

  return (
    <aside className="w-64 admin-sidebar min-h-screen p-4 space-y-6">
      <h2 className="text-2xl font-bold text-[hsl(var(--agw-gold))]">
        AGW Admin
      </h2>

      <nav className="space-y-1">
        {items.map((item) => {
          const Icon = item.icon;
          const active = pathname === item.path;

          return (
            <Link
              key={item.path}
              href={item.path}
              className={`flex items-center gap-3 px-3 py-2 rounded-md transition
                ${
                  active
                    ? "bg-[hsl(var(--agw-gold))] text-black font-semibold"
                    : "text-neutral-300 hover:text-white hover:bg-neutral-800"
                }`}
            >
              <Icon size={18} />
              <span>{item.label}</span>
            </Link>
          );
        })}
      </nav>
    </aside>
  );
}
```

├─ app/admin/components/AdminTopbar.tsx
```
"use client";

import { ShieldCheck, Wifi, Database, LogOut } from "lucide-react";
import { useRouter } from "next/navigation";

export default function AdminTopbar() {
  const router = useRouter();

  function logout() {
    router.push("/admin/logout");
  }

  return (
    <header className="admin-topbar w-full px-6 py-4 flex justify-between items-center shadow-sm">
      {/* LEFT */}
      <div className="flex items-center gap-3">
        <ShieldCheck size={20} className="text-[hsl(var(--agw-gold))]" />
        <h1 className="text-lg font-semibold text-[hsl(var(--agw-gold))] tracking-wide">
          AGW Admin Panel
        </h1>

        <span className="px-2 py-1 text-xs rounded-md bg-[hsl(var(--agw-gold))] text-black ml-2">
          ADMIN
        </span>
      </div>

      {/* RIGHT */}
      <div className="flex items-center gap-6">
        <div className="flex items-center gap-1 text-neutral-400 text-sm">
          <Wifi size={16} className="text-green-400" />
          Online
        </div>

        <div className="flex items-center gap-1 text-neutral-400 text-sm">
          <Database size={16} className="text-blue-400" />
          KV OK
        </div>

        <button
          onClick={logout}
          className="flex items-center gap-2 px-3 py-1 rounded-md admin-btn admin-btn-danger hover:opacity-90"
        >
          <LogOut size={16} />
          Logout
        </button>
      </div>
    </header>
  );
}
```

├─ app/admin/layout.tsx
```
"use client";

import type { ReactNode } from "react";
import AdminSidebar from "./components/AdminSidebar";
import AdminTopbar from "./components/AdminTopbar";

interface AdminLayoutProps {
  children: ReactNode;
}

export default function AdminLayout({ children }: AdminLayoutProps) {
  return (
    <div className="admin-theme min-h-screen flex">
      <AdminSidebar />

      <div className="flex flex-col flex-1 min-h-screen">
        <AdminTopbar />

        <main className="p-6 flex-1">
          {children}
        </main>
      </div>
    </div>
  );
}
```

├─ app/admin/login/page.tsx
```
"use client";

import { useState } from "react";

export default function AdminLoginPage() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");

  async function handleLogin(e: React.FormEvent) {
    e.preventDefault();
    setError("");

    const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/admin/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password }),
    });

    const data = await res.json();

    if (!res.ok) {
      setError(data.error || "Errore login");
      return;
    }

    window.location.href = "/admin";
  }

  return (
    <main className="min-h-screen flex items-center justify-center bg-black">
      <form
        onSubmit={handleLogin}
        className="bg-neutral-900 p-8 rounded-xl shadow-xl w-full max-w-md space-y-4"
      >
        <h1 className="text-2xl text-[hsl(var(--agw-gold))] font-bold text-center">
          Admin Login
        </h1>

        {error && (
          <p className="text-red-500 text-center">{error}</p>
        )}

        <input
          className="admin-input w-full"
          type="email"
          placeholder="Email admin"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
        />

        <input
          className="admin-input w-full"
          type="password"
          placeholder="Password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
        />

        <button
          type="submit"
          className="admin-btn admin-btn-gold w-full"
        >
          Entra
        </button>
      </form>
    </main>
  );
}
```

├─ app/admin/missions/page.tsx
```
"use client";

export default function AdminMissions() {
  return (
    <div className="space-y-6">
      <h1 className="text-2xl admin-title">Gestione Missioni</h1>

      <div className="admin-card space-y-3">
        <p className="admin-muted">Controlla e gestisci le missioni globali:</p>
        <ul className="admin-muted list-disc pl-4">
          <li>Lista missioni</li>
          <li>Creazione / Modifica / Rimozione</li>
          <li>Missioni attive</li>
          <li>Completamenti sospetti</li>
        </ul>
      </div>
    </div>
  );
}
```

├─ app/admin/page.tsx
```
"use client";

import { useEffect, useState } from "react";

export default function AdminHome() {
  const [valid, setValid] = useState<boolean | null>(null);
  const [overview, setOverview] = useState<any>(null);

  // Recupera sessione admin dal browser
  const sessionId =
    typeof window !== "undefined"
      ? localStorage.getItem("agw_admin_session")
      : null;

  async function validate() {
    if (!sessionId) {
      setValid(false);
      return;
    }

    const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/admin/me`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ sessionId })
    });

    const data = await res.json();

    setValid(data.ok === true);

    if (data.ok) {
      await loadOverview();
    }
  }

  async function loadOverview() {
    const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/admin/overview`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ sessionId })
    });

    const data = await res.json();
    setOverview(data);
  }

  useEffect(() => {
    validate();
  }, []);

  if (valid === null)
    return <p className="admin-muted p-6">Verifica in corso...</p>;

  if (!valid)
    return (
      <div className="admin-card p-6">
        <p className="admin-btn-danger p-2 rounded-md text-center">
          Accesso negato
        </p>
      </div>
    );

  if (!overview)
    return <p className="admin-muted p-6">Caricamento dati...</p>;

  return (
    <div className="space-y-8">
      <h1 className="text-3xl admin-title">Admin Dashboard AGW</h1>

      <div className="admin-card space-y-6">
        <h2 className="text-xl admin-title">Panoramica Sistema</h2>

        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <Stat label="Utenti totali" value={overview.totalUsers} />
          <Stat label="Abbonamenti attivi" value={overview.activeSubscriptions} />
          <Stat label="Bonus attivi" value={overview.activeBonuses} />
          <Stat label="KRM totali generati" value={overview.totalKRM} />
          <Stat label="Day acquistati" value={overview.totalDay} />
          <Stat label="Missioni completate" value={overview.totalMissions} />
        </div>
      </div>
    </div>
  );
}

function Stat({ label, value }: any) {
  return (
    <div className="admin-stat space-y-1">
      <p className="admin-muted">{label}</p>
      <p className="admin-stat-value">{value}</p>
    </div>
  );
}
```

├─ app/admin/src/types/Users.ts
```typescript
export interface User {
    id: string;
    index: number;
  
    nickname: string;
    firstname: string;
    lastname: string;
    email: string;
    password: string;
    phone: string | null;
  
    profile_image: string | null;
    avatar_ai: string | null;
  
    mailing: {
      primary: string;
      secondary: string | null;
      verified: boolean;
      verification_sent_at: number | null;
      verified_at: number | null;
      preferences: {
        newsletter: boolean;
        missions: boolean;
        rewards: boolean;
        billing: boolean;
        security: boolean;
      };
      status: {
        bounced: boolean;
        soft_bounce_count: number;
        hard_bounce: boolean;
        unsubscribe: boolean;
        unsubscribe_at: number | null;
      };
      log: any[];
    };
  
    personal: {
      birthdate: string | null;
      weight: number | null;
      height: number | null;
      gender: string | null;
      job: string | null;
    };
  
    status: {
      suspended: boolean;
      createdAt: number;
    };
  
    stats: {
      level_total: number;
      level_year: number;
      rank_month: number;
      motivation_week: number;
      assessment_day: number;
  
      krm_total: number;
      krm_year: number;
      krm_month: number;
      krm_week: number;
      krm_day: number;
  
      missions_completed_total: number;
      missions_completed_month: number;
      missions_completed_week: number;
      missions_completed_today: number;
    };
  
    discipline: {
      daily_completed: number;
      daily_goal: number;
      weekly_completed: number;
      weekly_goal: number;
    };
  
    subscription: {
      type: string | null;
      renew_every: number;
      last_payment_at: number | null;
      payment_status: "green" | "orange" | "red" | null;
      expires_at: number | null;
    };
  
    bonus: {
      award: string | null;
      expiresAt: number | null;
      days?: number;
    } | null;
  
    missions: {
      status: "approved" | "pending" | "rejected";
      [k: string]: any;
    }[];
  
    delta7?: number;
  }
  ```

├─ app/admin/subscriptions/page.tsx
```
"use client";

export default function AdminSubscriptions() {
  return (
    <div className="space-y-6">
      <h1 className="text-2xl admin-title">Gestione Abbonamenti</h1>

      <div className="admin-card space-y-3">
        <p className="admin-muted">Qui potrai vedere e gestire:</p>
        <ul className="admin-muted list-disc pl-4">
          <li>Abbonamenti attivi</li>
          <li>Data scadenza</li>
          <li>Rinnovi manuali</li>
          <li>Anomalie abbonamenti</li>
        </ul>
      </div>
    </div>
  );
}
```

├─ app/admin/system/page.tsx
```
"use client";

export default function AdminSystem() {
  return (
    <div className="space-y-6">
      <h1 className="text-2xl admin-title">Controllo Sistema</h1>

      <div className="admin-card space-y-3">
        <p className="admin-muted">Strumenti e diagnostica:</p>
        <ul className="admin-muted list-disc pl-4">
          <li>Test API</li>
          <li>Stato KV</li>
          <li>Logs Worker</li>
          <li>Reset Bonus settimanale</li>
          <li>Health-check</li>
          <li>Sicurezza</li>
        </ul>
      </div>
    </div>
  );
}
```

├─ app/admin/users/UserTable.tsx
```
"use client";

import { useState } from "react";

export default function UserTable({ users }: { users: any[] }) {
  const [search, setSearch] = useState("");
  const [selected, setSelected] = useState<string[]>([]);

  const safeUsers = Array.isArray(users) ? users : [];

  const filtered = safeUsers.filter((u) =>
    JSON.stringify(u).toLowerCase().includes(search.toLowerCase())
  );

  function toggle(id: string) {
    setSelected((prev) =>
      prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id]
    );
  }

  async function handleBulkDelete() {
    if (!confirm(`Eliminare ${selected.length} utenti?`)) return;

    for (const id of selected) {
      await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/admin/user/update`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id, field: "delete" })
      });
    }

    alert("Utenti eliminati");
    window.location.reload();
  }

  return (
    <div className="admin-card p-4 space-y-4 overflow-auto">
      <input
        className="admin-input"
        placeholder="Cerca..."
        value={search}
        onChange={(e) => setSearch(e.target.value)}
      />

      {selected.length > 0 && (
        <button
          onClick={handleBulkDelete}
          className="admin-btn admin-btn-danger"
        >
          Elimina selezionati ({selected.length})
        </button>
      )}

      <div className="overflow-auto">
        <table className="min-w-full text-sm text-left border-collapse">
          <thead>
            <tr>
              <Th></Th>
              <Th>Edit</Th>
              <Th>Delete</Th>
              <Th>ID</Th>
              <Th>Email</Th>
              <Th>Name</Th>
              <Th>Status</Th>
            </tr>
          </thead>

          <tbody>
            {filtered.map((user) => (
              <tr key={user.id}>
                <Td>
                  <input
                    type="checkbox"
                    checked={selected.includes(user.id)}
                    onChange={() => toggle(user.id)}
                  />
                </Td>

                <Td>
                  <a
                    href={`/admin/users/${user.id}/edit`}
                    className="admin-btn admin-btn-blue text-xs"
                  >
                    Edit
                  </a>
                </Td>

                <Td>
                  <button
                    className="admin-btn admin-btn-danger text-xs"
                    onClick={async () => {
                      if (!confirm(`Eliminare ${user.email}?`)) return;

                      await fetch(
                        `${process.env.NEXT_PUBLIC_API_URL}/api/admin/user/update`,
                        {
                          method: "POST",
                          headers: { "Content-Type": "application/json" },
                          body: JSON.stringify({
                            id: user.id,
                            field: "delete"
                          })
                        }
                      );

                      alert("Utente eliminato");
                      window.location.reload();
                    }}
                  >
                    Delete
                  </button>
                </Td>

                <Td>{user.id}</Td>
                <Td>{user.email}</Td>
                <Td>{user.firstname} {user.lastname}</Td>
                <Td>{user.status?.suspended ? "Sospeso" : "Attivo"}</Td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

function Th({ children }: any) {
  return (
    <th className="px-3 py-2 font-semibold text-[var(--admin-gold)] whitespace-nowrap">
      {children}
    </th>
  );
}

function Td({ children }: any) {
  return <td className="px-3 py-2 whitespace-nowrap">{children}</td>;
}
```

├─ app/admin/users/[id]/edit/page.tsx
```
"use client";

import type { User } from "app/admin/src/types/Users";
import { useEffect, useState } from "react";
import { useParams } from "next/navigation";

/* ============================================================================
   PAGE: ADMIN — EDIT USER
   Compatibile con Next.js 16 + nuovo BFF /api/admin/*
============================================================================ */

export default function EditUser() {
  const { id } = useParams();

  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [msg, setMsg] = useState("");

  /* ============================================================================
     LOAD USER FROM BFF
  ============================================================================ */
  async function loadUser() {
    setLoading(true);

    const res = await fetch(`/api/admin/users`, { cache: "no-store" });
    const data = await res.json();

    if (!data.ok || !Array.isArray(data.users)) {
      setUser(null);
      setLoading(false);
      return;
    }

    const found = data.users.find((u: any) => u.id === id);
    setUser(found || null);
    setLoading(false);
  }

  /* ============================================================================
     GENERIC FIELD UPDATE
  ============================================================================ */
  async function update(field: string, value: any) {
    if (!user) return;

    setSaving(true);
    setMsg("");

    const res = await fetch(`/api/admin/user-update`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        id,
        field,
        value,
      }),
    });

    const data = await res.json();

    if (!data.ok) {
      setMsg("❌ " + (data.error || "Errore salvataggio"));
      setSaving(false);
      return;
    }

    setUser(data.user);
    setMsg("✔ Salvato");
    setSaving(false);
  }

  /* ============================================================================
     RESET PASSWORD
  ============================================================================ */
  async function resetPassword() {
    if (!user) return;

    const newPass = prompt("Inserisci nuova password:");
    if (!newPass) return;

    const res = await fetch(`/api/user/update-password`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        userId: user.id,
        oldPassword: "",
        newPassword: newPass,
      }),
    });

    const data = await res.json();

    if (data.ok) alert("Password aggiornata");
    else alert("Errore durante l'aggiornamento");
  }

  /* ============================================================================
     DELETE USER
  ============================================================================ */
  async function deleteUser() {
    if (!user) return;
    if (!confirm("Confermi eliminazione DEFINITIVA?")) return;

    const res = await fetch(`/api/admin/user-update`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        id: user.id,
        field: "delete",
      }),
    });

    const data = await res.json();

    if (data.deleted) {
      alert("Utente eliminato");
      window.location.href = "/admin/users";
    } else {
      alert("Errore eliminazione");
    }
  }

  /* ============================================================================
     LOAD ON MOUNT
  ============================================================================ */
  useEffect(() => {
    loadUser();
  }, []);

  /* ============================================================================
     RENDERING
  ============================================================================ */
  if (loading) return <p className="p-6 admin-muted">Loading...</p>;
  if (!user) return <p className="p-6 text-red-400">User not found</p>;

  return (
    <div className="space-y-8">
      <h1 className="admin-title text-3xl font-bold">
        Editing User #{user.index} — {user.nickname}
      </h1>

      <p className="admin-muted">{msg}</p>

      {/* BASIC INFO */}
      <section className="admin-card p-6 space-y-4">
        <h2 className="admin-title text-xl">Profilo</h2>

        <Field label="Email" value={user.email} update={(v) => update("email", v)} />
        <Field label="Firstname" value={user.firstname} update={(v) => update("firstname", v)} />
        <Field label="Lastname" value={user.lastname} update={(v) => update("lastname", v)} />
      </section>

      {/* STATS */}
      <section className="admin-card p-6 space-y-4">
        <h2 className="admin-title text-xl">Stats</h2>

        <Field
          label="KRM Totale"
          value={user.stats?.krm_total}
          update={(v) => update("stats.krm_total", Number(v))}
        />

        <Field
          label="Livello"
          value={user.stats?.level_total}
          update={(v) => update("stats.level_total", Number(v))}
        />
      </section>

      {/* STATUS */}
      <section className="admin-card p-6 space-y-4">
        <h2 className="admin-title text-xl">Status</h2>

        <select
          className="admin-input"
          defaultValue={user.status?.suspended ? "suspended" : "active"}
          onChange={(e) => update("status.suspended", e.target.value === "suspended")}
        >
          <option value="active">Active</option>
          <option value="suspended">Suspended</option>
        </select>
      </section>

      {/* RESET PASSWORD */}
      <div className="admin-card p-6">
        <button className="admin-btn admin-btn-blue" onClick={resetPassword}>
          Reset Password
        </button>
      </div>

      {/* DELETE USER */}
      <div className="admin-card p-6">
        <button className="admin-btn admin-btn-danger" onClick={deleteUser}>
          Delete User
        </button>
      </div>
    </div>
  );
}

/* ============================================================================
   FIELD COMPONENT
============================================================================ */
type FieldProps<T> = {
  label: string;
  value: T;
  update: (v: T) => void;
};

function Field<T>({ label, value, update }: FieldProps<T>) {
  return (
    <div className="space-y-2">
      <label className="admin-muted text-sm">{label}</label>

      <input
        className="admin-input"
        defaultValue={value != null ? String(value) : ""}
        onBlur={(e) => {
          let v: any = e.target.value;
          if (typeof value === "number") v = Number(v);
          update(v as T);
        }}
      />
    </div>
  );
}
```

├─ app/admin/users/page.tsx
```
"use client";

import { Suspense, useEffect, useState } from "react";
import UserTable from "./UserTable";

export default function AdminUsersPage() {
  return (
    <Suspense fallback={<p className="admin-muted">Caricamento utenti...</p>}>
      <AdminUsers />
    </Suspense>
  );
}

function AdminUsers() {
  const [userList, setUserList] = useState<any[]>([]);
  const [searchId, setSearchId] = useState("");
  const [selectedUser, setSelectedUser] = useState<any>(null);
  const [loading, setLoading] = useState(false);
  const [msg, setMsg] = useState("");

  async function loadUserList() {
    const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/admin/users/list`, {
      method: "GET",
      cache: "no-store"
    });

    const data = await res.json();
    if (data.ok) {
      setUserList(data.users);
    } else {
      setMsg(data.error || "Errore di caricamento utenti");
    }
  }

  useEffect(() => {
    loadUserList();
  }, []);

  async function searchUser() {
    if (!searchId) return;

    setLoading(true);
    setMsg("");

    const res = await fetch(`/api/admin/user/get`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id: searchId })
    });

    const data = await res.json();
    if (data.error) {
      setSelectedUser(null);
      setMsg(data.error);
    } else {
      setSelectedUser(data);
    }

    setLoading(false);
  }

  return (
    <div className="space-y-6">
      <h1 className="admin-title text-2xl font-bold">Gestione Utenti</h1>

      <button
        onClick={async () => {
          const res = await fetch(`/api/admin/user/create`, {
            method: "POST"
          });

          const data = await res.json();

          if (data.error) {
            alert("Errore creando utente: " + data.error);
            return;
          }

          window.location.href = `/admin/users/${data.id}/edit`;
        }}
        className="admin-btn admin-btn-gold"
      >
        + Create New User
      </button>

      <UserTable users={userList} />

      <div className="admin-card space-y-4">
        <p className="admin-muted">Cerca utente per ID:</p>

        <input
          className="admin-input"
          value={searchId}
          onChange={(e) => setSearchId(e.target.value)}
        />

        <button
          onClick={searchUser}
          className="admin-btn admin-btn-gold"
        >
          {loading ? "Ricerca..." : "Cerca"}
        </button>

        {msg && <p className="admin-muted">{msg}</p>}
      </div>

      {selectedUser && (
        <div className="admin-card">
          <p className="admin-title">User loaded</p>
        </div>
      )}
    </div>
  );
}
```

├─ app/api/admin/_utils.ts
```typescript
import { cookies } from "next/headers";

export async function proxyAdmin(path: string, payload?: any, method: "GET" | "POST" = "POST") {
  const cookieStore = await cookies();
  const sessionId = cookieStore.get("agw_admin_session")?.value;

  if (!sessionId) {
    return {
      ok: false,
      status: 403,
      json: { error: "UNAUTHORIZED" }
    };
  }

  const backendBase = process.env.NEXT_PUBLIC_API_URL;

  // GET: sessionId in querystring
  let url = `${backendBase}${path}`;
  if (method === "GET") {
    const qs = `?sessionId=${sessionId}`;
    url = url.includes("?") ? `${url}&sessionId=${sessionId}` : `${url}${qs}`;
  }

  const res = await fetch(url, {
    method,
    headers: { "Content-Type": "application/json" },
    body: method === "POST" ? JSON.stringify({ sessionId, ...(payload || {}) }) : undefined
  });

  return {
    ok: res.ok,
    status: res.status,
    json: await res.json()
  };
}
```

├─ app/api/admin/login/route.ts
```typescript
import { NextResponse } from "next/server";

export async function POST(req: Request) {
  const body = await req.json();

  const backend = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/admin/login`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body),
  });

  const data = await backend.json();

  if (!backend.ok) {
    return NextResponse.json(data, { status: backend.status });
  }

  const res = NextResponse.json({ ok: true });

  res.cookies.set("agw_admin_session", data.sessionId, {
    httpOnly: true,
    secure: true,
    sameSite: "lax",
    path: "/",
  });

  return res;
}
```

├─ app/api/admin/logout/route.ts
```typescript
import { NextResponse } from "next/server";
import { cookies } from "next/headers";

export async function POST() {
  const cookieStore = await cookies();

  cookieStore.set("agw_admin_session", "", {
    httpOnly: true,
    secure: true,
    sameSite: "lax",
    path: "/",
    expires: new Date(0),
  });

  return NextResponse.json({ ok: true });
}
```

├─ app/api/admin/me/route.ts
```typescript
import { NextResponse } from "next/server";
import { proxyAdmin } from "../_utils";

export async function POST() {
  const result = await proxyAdmin("/api/admin/me");

  return NextResponse.json(result.json, { status: result.status });
}
```

├─ app/api/admin/overview/route.ts
```typescript
import { NextResponse } from "next/server";
import { proxyAdmin } from "../_utils";

export async function POST() {
  const result = await proxyAdmin("/api/admin/overview");

  return NextResponse.json(result.json, { status: result.status });
}
```

├─ app/api/admin/user-update/route.ts
```typescript
import { NextResponse } from "next/server";
import { proxyAdmin } from "../../admin/_utils";

export async function POST(req: Request) {
  const body = await req.json();
  const result = await proxyAdmin("/api/admin/user/update", body);

  return NextResponse.json(result.json, { status: result.status });
}
```

├─ app/api/admin/user/create/route.ts
```typescript
import { NextResponse } from "next/server";
import { proxyAdmin } from "../../_utils";

export async function POST() {
  const id = crypto.randomUUID();

  const result = await proxyAdmin("/api/admin/user/update", {
    id,
    field: "create",
    value: {}
  });

  if (!result.ok) {
    return NextResponse.json(result.json, { status: result.status });
  }

  return NextResponse.json({ ok: true, id });
}
```

├─ app/api/admin/user/get/route.ts
```typescript
import { NextResponse } from "next/server";
import { proxyAdmin } from "../../_utils";
export async function POST(req: Request) {
  const { id } = await req.json();

  const result = await proxyAdmin("/api/admin/users/list", {}, "GET");

  if (!result.ok) {
    return NextResponse.json(result.json, { status: result.status });
  }

  const user = result.json.users.find((u: any) => u.id === id);

  if (!user) {
    return NextResponse.json({ error: "User not found" }, { status: 404 });
  }

  return NextResponse.json(user);
}
```

├─ app/api/admin/users/route.ts
```typescript
import { NextResponse } from "next/server";
import { cookies } from "next/headers";

export async function GET() {
  const cookieStore = await cookies();
  const sessionId = cookieStore.get("agw_admin_session")?.value;

  if (!sessionId)
    return NextResponse.json({ error: "Unauthorized" }, { status: 403 });

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/admin/users/list`,
    { cache: "no-store" }
  );

  const data = await backend.json();
  return NextResponse.json(data, { status: backend.status });
}
```

├─ app/api/user/delete-account/route.ts
```typescript
import { NextResponse } from "next/server";
import { cookies } from "next/headers";

export async function POST() {
  const cookieStore = await cookies();
  const userId = cookieStore.get("agw_session")?.value;

  if (!userId)
    return NextResponse.json({ error: "Not authenticated" }, { status: 401 });

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/delete-account`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId }),
    }
  );

  return NextResponse.json(await backend.json(), {
    status: backend.status,
  });
}
```

├─ app/api/user/do-reset/route.ts
```typescript
import { NextResponse } from "next/server";

export async function POST(req: Request) {
  const body = await req.json();

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/do-reset`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    }
  );

  return NextResponse.json(await backend.json(), {
    status: backend.status,
  });
}
```

├─ app/api/user/get/route.ts
```typescript
import { NextResponse } from "next/server";
import { cookies } from "next/headers";

export const dynamic = "force-dynamic";

export async function POST() {
  const cookieStore = await cookies();
  const sessionId = cookieStore.get("agw_session")?.value;

  if (!sessionId)
    return NextResponse.json(
      { ok: false, error: "NOT_AUTH" },
      { status: 401 }
    );

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/get`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ sessionId }),   // ✔ OBBLIGATORIO
      cache: "no-store",
    }
  );

  const data = await backend.json();

  return NextResponse.json(data, { status: backend.status });
}
```

├─ app/api/user/login/route.ts
```typescript
import { NextResponse } from "next/server";

interface LoginResponse {
  ok: boolean;
  sessionId?: string;
  error?: string;
}

export async function POST(req: Request) {
  const { email, password } = await req.json();

  // CHIAMATA AL BACKEND WORKER
  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/login`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password }),
    }
  );

  let data: LoginResponse;

  try {
    data = await backend.json();
  } catch {
    return NextResponse.json(
      { ok: false, error: "INVALID_BACKEND_RESPONSE" },
      { status: 500 }
    );
  }

  // ERRORE LOGIN LATO WORKER
  if (!backend.ok) {
    return NextResponse.json(data, { status: backend.status });
  }

  // LOGIN OK → sessionId deve esistere
  if (!data.sessionId) {
    return NextResponse.json(
      { ok: false, error: "MISSING_SESSION_ID" },
      { status: 500 }
    );
  }

  const isProd = process.env.NODE_ENV === "production";

  const res = NextResponse.json({ ok: true });

  res.cookies.set("agw_session", data.sessionId, {
    httpOnly: true,
    secure: isProd,
    sameSite: isProd ? "strict" : "lax",
    path: "/",
  });

  return res;
}
```

├─ app/api/user/logout/route.ts
```typescript
import { NextResponse } from "next/server";
import { cookies } from "next/headers";

export async function POST() {
  const cookieStore = await cookies();

  cookieStore.set("agw_session", "", {
    httpOnly: true,
    secure: true,
    sameSite: "lax",
    path: "/",
    expires: new Date(0),
  });

  return NextResponse.json({ ok: true });
}
```

├─ app/api/user/register/route.ts
```typescript
import { NextResponse } from "next/server";

export async function POST(req: Request) {
  const body = await req.json();

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/register`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    }
  );

  const data = await backend.json();
  return NextResponse.json(data, { status: backend.status });
}
```

├─ app/api/user/request-reset/route.ts
```typescript
import { NextResponse } from "next/server";

export async function POST(req: Request) {
  const { email } = await req.json();

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/request-reset`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email }),
    }
  );

  return NextResponse.json(await backend.json(), {
    status: backend.status,
  });
}
```

├─ app/api/user/update-avatar/route.ts
```typescript
import { NextResponse } from "next/server";
import { cookies } from "next/headers";

export async function POST(req: Request) {
  const cookieStore = await cookies();
  const userId = cookieStore.get("agw_session")?.value;

  if (!userId)
    return NextResponse.json({ error: "Not authenticated" }, { status: 401 });

  const { avatarBase64 } = await req.json();

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/update-avatar`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId, avatarBase64 }),
    }
  );

  return NextResponse.json(await backend.json(), {
    status: backend.status,
  });
}
```

├─ app/api/user/update-email-prefs/route.ts
```typescript
import { NextResponse } from "next/server";
import { cookies } from "next/headers";

export async function POST(req: Request) {
  const cookieStore = await cookies();
  const userId = cookieStore.get("agw_session")?.value;

  if (!userId)
    return NextResponse.json({ error: "Not authenticated" }, { status: 401 });

  const { prefs } = await req.json();

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/update-email-prefs`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId, prefs }),
    }
  );

  return NextResponse.json(await backend.json(), {
    status: backend.status,
  });
}
```

├─ app/api/user/update-password/route.ts
```typescript
import { NextResponse } from "next/server";
import { cookies } from "next/headers";

export async function POST(req: Request) {
  const cookieStore = await cookies();
  const userId = cookieStore.get("agw_session")?.value;

  if (!userId)
    return NextResponse.json({ error: "Not authenticated" }, { status: 401 });

  const body = await req.json();

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/update-password`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId, ...body }),
    }
  );

  return NextResponse.json(await backend.json(), {
    status: backend.status,
  });
}
```

├─ app/api/user/update-profile/route.ts
```typescript
import { NextResponse } from "next/server";
import { cookies } from "next/headers";

export async function POST(req: Request) {
  const cookieStore = await cookies();
  const userId = cookieStore.get("agw_session")?.value;

  if (!userId)
    return NextResponse.json({ error: "Not authenticated" }, { status: 401 });

  const data = await req.json();

  const backend = await fetch(
    `${process.env.NEXT_PUBLIC_API_URL}/api/user/update-profile`,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId, data }),
    }
  );

  return NextResponse.json(await backend.json(), {
    status: backend.status,
  });
}
```

├─ app/components/lib/apiClients.ts
```typescript
```

├─ app/components/lib/auth.ts
```typescript
```

├─ app/components/lib/session.ts
```typescript
```

├─ app/components/store/userStore.ts
```typescript
```

├─ app/dashboard/components/AvatarUploader.tsx
```
"use client";

import { useState } from "react";

export default function AvatarUploader({ user }: { user: any }) {
  const [preview, setPreview] = useState(user.profile_image);

  async function handleUpload(e: any) {
    const file = e.target.files[0];
    if (!file) return;

    const base64 = await toBase64(file);
    setPreview(base64);

    await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/user/update-avatar`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId: user.id, avatarBase64: base64 }),
    });

    alert("Avatar aggiornato");
  }

  function toBase64(file: File) {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result as string);
      reader.readAsDataURL(file);
    });
  }

  return (
    <div className="p-6 bg-white rounded-xl shadow-md flex gap-4">
      <img
        src={preview || "/default-avatar.png"}
        className="w-24 h-24 rounded-full object-cover border"
      />

      <div>
        <h3 className="font-semibold mb-2">Avatar</h3>

        <input type="file" accept="image/*" onChange={handleUpload} />

        <p className="text-sm mt-2 text-gray-500">
          Carica un’immagine quadrata.
        </p>
      </div>
    </div>
  );
}
```

├─ app/dashboard/components/DisciplineCard.tsx
```
export default function DisciplineCard({ user }: any) {
    return (
      <div className="bg-white p-6 rounded-xl shadow-sm">
        <h2 className="text-xl font-semibold mb-3">Disciplina</h2>
  
        <div className="flex justify-between text-lg font-medium">
          <div>
            Giornaliero:
            {" "}
            {user.discipline.daily_completed}/{user.discipline.daily_goal}
          </div>
  
          <div>
            Settimanale:
            {" "}
            {user.discipline.weekly_completed}/{user.discipline.weekly_goal}
          </div>
        </div>
      </div>
    );
  }
  ```

├─ app/dashboard/components/EmailPreferences.tsx
```
"use client";

import { useState } from "react";

export default function EmailPreferences({
  prefs,
  userId,
}: {
  prefs: any;
  userId: string;
}) {
  const [state, setState] = useState(prefs);

  async function savePrefs() {
    const res = await fetch("/api/user/update-email-prefs", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId, prefs: state }),
    });

    if (!res.ok) {
      alert("Errore aggiornamento preferenze email");
      return;
    }

    alert("Preferenze aggiornate");
  }

  return (
    <div className="p-6 bg-white rounded-xl shadow-md">
      <h2 className="text-xl font-bold mb-4">Preferenze Email</h2>

      <div className="flex flex-col gap-3">
        {Object.keys(state).map((key) => (
          <label key={key} className="flex items-center gap-2">
            <input
              type="checkbox"
              checked={(state as any)[key]}
              onChange={(e) =>
                setState({
                  ...state,
                  [key]: e.target.checked,
                })
              }
            />
            <span className="capitalize">{key}</span>
          </label>
        ))}
      </div>

      <button
        onClick={savePrefs}
        className="mt-4 bg-green-600 text-white px-4 py-2 rounded"
      >
        Salva preferenze
      </button>
    </div>
  );
}
```

├─ app/dashboard/components/LevelCard.tsx
```
export default function LevelCard({ user }: any) {
    return (
      <div className="bg-white p-6 rounded-xl shadow-sm">
        <h2 className="text-xl font-semibold mb-3">Il tuo livello</h2>
        <div className="text-5xl font-extrabold text-gray-900">
          {user.stats.level_total}
        </div>
        <p className="text-gray-600">
          Continua a migliorare per salire di livello.
        </p>
      </div>
    );
  }
  ```

├─ app/dashboard/components/LogoutButton.tsx
```
"use client";

export default function LogoutButton() {
  async function logout() {
    await fetch("/api/user/logout", { method: "POST" })
    window.location.href = "/login";
  }

  return (
    <button
      onClick={logout}
      className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
    >
      Logout
    </button>
  );
}
```

├─ app/dashboard/components/ProfileForm.tsx
```
"use client";

import { useState } from "react";

export default function ProfileForm({ user }: { user: any }) {
  const [form, setForm] = useState({
    firstname: user.firstname || "",
    lastname: user.lastname || "",
    nickname: user.nickname || "",
    birthdate: user.personal?.birthdate || "",
    gender: user.personal?.gender || "",
    height: user.personal?.height || "",
    weight: user.personal?.weight || "",
    job: user.personal?.job || "",
  });

  const [loading, setLoading] = useState(false);

  async function handleSave() {
    setLoading(true);

    const res = await fetch("/api/user/update-profile", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId: user.id, data: form }),
    });

    setLoading(false);

    if (!res.ok) {
      alert("Errore aggiornamento profilo");
      return;
    }

    alert("Profilo aggiornato");
  }

  return (
    <div className="p-6 bg-white rounded-xl shadow-md">
      <h2 className="text-xl font-bold mb-4">Dati Personali</h2>

      <div className="grid grid-cols-2 gap-4">
        {Object.keys(form).map((key) => (
          <div key={key} className="flex flex-col">
            <label className="text-sm font-medium capitalize">{key}</label>
            <input
              type="text"
              className="border p-2 rounded bg-gray-50"
              value={(form as any)[key]}
              onChange={(e) =>
                setForm({ ...form, [key]: e.target.value })
              }
            />
          </div>
        ))}
      </div>

      <button
        onClick={handleSave}
        className="mt-4 bg-blue-600 text-white px-4 py-2 rounded"
      >
        {loading ? "Salvataggio..." : "Salva"}
      </button>
    </div>
  );
}
```

├─ app/dashboard/components/ProfileStrip.tsx
```
export default function ProfileStrip({ user }: any) {
    return (
      <div className="flex items-center gap-4 bg-white p-5 rounded-xl shadow-sm">
        <div className="h-14 w-14 rounded-full bg-gray-200" />
  
        <div>
          <div className="text-lg font-semibold">{user.firstname}</div>
          <div className="text-gray-500 text-sm">{user.email}</div>
        </div>
      </div>
    );
  }
  ```

├─ app/dashboard/components/Sidebar.tsx
```
import LogoutButton from "./LogoutButton";
export default function Sidebar() {
    return (
      <aside className="w-64 bg-white shadow-md p-6 flex flex-col gap-4">
        <h2 className="text-xl font-bold">AGW</h2>
  
        <a href="/dashboard" className="text-gray-700 hover:text-black">
          Dashboard
        </a>
        <a href="/dashboard/profile" className="text-gray-700 hover:text-black">
          Profilo
        </a>
        <a href="/dashboard/missions" className="text-gray-700 hover:text-black">
          Missioni
        </a>
        <a href="/dashboard/stats" className="text-gray-700 hover:text-black">
          Statistiche
        </a>
        <a href="/dashboard/settings" className="text-gray-700 hover:text-black">
          Impostazioni
        </a>
        <li className="mt-4">
        <form action={"/api/user/logout"} method="POST">

        <button className="w-full text-left px-4 py-2 text-red-600 hover:bg-red-100 rounded">
        Logout
        </button>
        </form>
        </li>
      </aside>
    );
  }
  ```

├─ app/dashboard/components/StatsRow.tsx
```
export default function StatsRow({ user }: any) {
    return (
      <div className="grid grid-cols-3 gap-4">
        <div className="bg-white p-5 rounded-xl shadow-sm text-center">
          <div className="text-gray-400 text-sm">KRM Totali</div>
          <div className="text-3xl font-semibold">
            {user.stats.krm_total}
          </div>
        </div>
  
        <div className="bg-white p-5 rounded-xl shadow-sm text-center">
          <div className="text-gray-400 text-sm">Missioni</div>
          <div className="text-3xl font-semibold">
            {user.stats.missions_completed_total}
          </div>
        </div>
  
        <div className="bg-white p-5 rounded-xl shadow-sm text-center">
          <div className="text-gray-400 text-sm">Attività 7 giorni</div>
          <div className="text-3xl font-semibold">
            {user.stats.dayPurchasesLast7Days}
          </div>
        </div>
      </div>
    );
  }
  ```

├─ app/dashboard/components/Topbar.tsx
```
export default function Topbar({ user }: any) {
    return (
      <header className="h-16 bg-white shadow flex items-center justify-between px-6">
        <div className="text-lg font-semibold">Benvenuto</div>
  
        <div className="flex items-center gap-3">
          <span className="text-gray-700">{user.firstname || user.email}</span>
          <div className="h-10 w-10 rounded-full bg-gray-200"></div>
        </div>
      </header>
    );
  }
  ```

├─ app/dashboard/layout.tsx
```
"use client";

import Sidebar from "./components/Sidebar";
import Topbar from "./components/Topbar";
import { useEffect, useState } from "react";

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const [user, setUser] = useState<any>(null);

  useEffect(() => {
    async function load() {
        const res = await fetch("/api/user/get", { method: "POST" ,  cache: "no-store"});
        const data = await res.json();
        if (!data.ok) window.location.href = "/login";
        setUser(data.user);
    }
    load();
  }, []);

  if (!user) return null;

  return (
    <div className="min-h-screen flex bg-gray-100">
      <Sidebar />
      <div className="flex-1 flex flex-col">
        <Topbar user={user} />
        <main className="p-6">{children}</main>
      </div>
    </div>
  );
}
```

├─ app/dashboard/page.tsx
```
"use client";

import ProfileStrip from "./components/ProfileStrip";
import LevelCard from "./components/LevelCard";
import StatsRow from "./components/StatsRow";
import DisciplineCard from "./components/DisciplineCard";
import { useEffect, useState } from "react";

export default function DashboardPage() {
  const [user, setUser] = useState<any>(null);

  useEffect(() => {
    async function load() {
      const res = await fetch("/api/user/get", { method: "POST" , cache: "no-store"});
      const data = await res.json();
      if (!data.ok) window.location.href = "/login";
      setUser(data.user);
    }
    load();
  }, []);

  if (!user) return null;

  return (
    <div className="flex flex-col gap-6 max-w-4xl mx-auto">
      <ProfileStrip user={user} />
      <LevelCard user={user} />
      <StatsRow user={user} />
      <DisciplineCard user={user} />
    </div>
  );
}
```

├─ app/dashboard/profile/page.tsx
```
import { cookies } from "next/headers";
import { redirect } from "next/navigation";
import ProfileForm from "../components/ProfileForm";
import EmailPreferences from "../components/EmailPreferences";
import AvatarUploader from "../components/AvatarUploader";

export default async function ProfilePage() {
  const cookieStore = await cookies();
  const session = cookieStore.get("agw_session")?.value;

  if (!session) redirect("/login");

  const apiUrl = process.env.NEXT_PUBLIC_API_URL!;
  const res = await fetch(`${apiUrl}/api/user/get`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id: session }),
    cache: "no-store",
  });

  const data = await res.json();
const user = data.user;

  return (
    <div className="flex flex-col gap-8 p-6">
      <h1 className="text-3xl font-bold">Il tuo Profilo</h1>

      <AvatarUploader user={user} />

      <ProfileForm user={user} />

      <EmailPreferences prefs={user.mailing.preferences} userId={user.id} />
    
    </div>
    
  );
}
```

├─ app/dashboard/settings/DangerZone.tsx
```
"use client";

export default function DangerZone() {
  async function handleDelete() {
    if (!confirm("Sei sicuro? Questa azione è irreversibile.")) return;

    // 1) Delete account on backend via BFF
    const res = await fetch("/api/user/delete-account", {
      method: "POST",
    });

    if (!res.ok) {
      alert("Errore durante l'eliminazione dell'account.");
      return;
    }

    // 2) Remove session cookie client-side (fail-safe)
    document.cookie = "agw_session=; Path=/; Max-Age=0; SameSite=Lax;";

    // 3) Clear any local/session storage if needed
    localStorage.clear();
    sessionStorage.clear();

    // 4) Notify user and redirect securely
    alert("Account eliminato correttamente.");
    window.location.href = "/";
  }

  return (
    <div className="p-6 bg-red-50 border border-red-200 rounded-xl shadow-md">
      <h2 className="text-xl font-bold text-red-700 mb-4">Zona Pericolosa</h2>

      <button
        onClick={handleDelete}
        className="bg-red-600 text-white px-4 py-2 rounded"
      >
        Elimina Account
      </button>
    </div>
  );
}
```

├─ app/dashboard/settings/NotificationSetting.tsx
```
"use client";

import { useState } from "react";

export default function NotificationSettings() {
  const [pushEnabled, setPushEnabled] = useState(false);

  return (
    <div className="p-6 bg-white rounded-xl shadow-md">
      <h2 className="text-xl font-bold mb-4">Notifiche</h2>

      <label className="flex items-center gap-2">
        <input
          type="checkbox"
          checked={pushEnabled}
          onChange={(e) => setPushEnabled(e.target.checked)}
        />
        Attiva notifiche push (coming soon)
      </label>
    </div>
  );
}
```

├─ app/dashboard/settings/SecurityPanel.tsx
```
"use client";

import { useState } from "react";

export default function SecurityPanel() {
  const [oldPass, setOldPass] = useState("");
  const [newPass, setNewPass] = useState("");
    
  async function changePassword() {
    const me = await fetch("/api/user/get", { method: "POST" }).then(r => r.json());
    if (!me.ok) {
      alert("Sessione non valida");
      return;
    }
  
    const userId = me.user.id;
  
    const res = await fetch("/api/user/update-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        userId,
        oldPassword: oldPass,
        newPassword: newPass
      })
    });
  
    if (!res.ok) {
      alert("Errore nel cambio password");
      return;
    }
  
    alert("Password aggiornata");
  }
  
  return (
    <div className="p-6 bg-white rounded-xl shadow-md">
      <h2 className="text-xl font-bold mb-4">Sicurezza</h2>

      <label className="flex flex-col mb-2">
        Vecchia password
        <input
          type="password"
          className="border p-2 rounded"
          onChange={(e) => setOldPass(e.target.value)}
        />
      </label>

      <label className="flex flex-col mb-2">
        Nuova password
        <input
          type="password"
          className="border p-2 rounded"
          onChange={(e) => setNewPass(e.target.value)}
        />
      </label>

      <button
        onClick={changePassword}
        className="mt-2 bg-blue-600 text-white px-4 py-2 rounded"
      >
        Aggiorna
      </button>
    </div>
  );
}
```

├─ app/dashboard/settings/page.tsx
```
import { cookies } from "next/headers";
import { redirect } from "next/navigation";
import SecurityPanel from "./SecurityPanel";
import NotificationSettings from "./NotificationSetting";
import DangerZone from "./DangerZone";

export default async function SettingsPage() {
  const cookieStore = await cookies();
  const session = cookieStore.get("agw_session")?.value;

  if (!session) redirect("/login");

  return (
    <div className="flex flex-col gap-8 p-6">
      <h1 className="text-3xl font-bold">Impostazioni Account</h1>

      <SecurityPanel />
      <NotificationSettings />
      <DangerZone />
    </div>
  );
}
```

├─ app/forgot-password/page.tsx
```
"use client";

import { useState, useEffect } from "react";

export default function ForgotPasswordPage() {
  const [email, setEmail] = useState("");

  useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const preEmail = params.get("email");
    if (preEmail) setEmail(preEmail);
  }, []);

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();

    await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/user/request-reset`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });

    alert("Se l’email è registrata, riceverai un link per reimpostare la password.");
  }

  return (
    <main className="min-h-screen flex items-center justify-center bg-gray-100 p-6">
      <div className="bg-white p-8 rounded-xl shadow-lg max-w-md w-full">
        <h1 className="text-2xl font-bold mb-6 text-center">
          Recupera Password
        </h1>

        <form onSubmit={handleSubmit} className="flex flex-col gap-4">
          <input
            type="email"
            placeholder="Inserisci la tua email"
            className="p-3 border rounded-lg"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            required
          />

          <button
            type="submit"
            className="py-3 bg-black text-white rounded-lg font-semibold hover:bg-gray-800 transition"
          >
            Invia link di recupero
          </button>
        </form>
      </div>
    </main>
  );
}
```

├─ app/layout.tsx
```
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";


const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "AGW - A Gold Winner",
  description: "Reward-Based System",
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <head>
        <link rel="manifest" href="/manifest.json" />
        <meta name="theme-color" content="#FFD700" />
        <link rel="apple-touch-icon" href="/icons/icon-192.png" />
      </head>
      <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
        {children}
      </body>
    </html>
  );
}
```

├─ app/login/page.tsx
```
"use client";

import { useState } from "react";

export default function LoginPage() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");
  const [failCount, setFailCount] = useState(0);

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    setError("");

    const res = await fetch("/api/user/login"
      , {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ email, password })
    });
    

    const data = await res.json();

    // EMAIL NON ESISTE
    if (res.status === 404 && data.error === "EMAIL_NOT_FOUND") {
      setError("Questa email non risulta registrata.");
      return;
    }

    // PASSWORD ERRATA
    if (res.status === 401 && data.error === "WRONG_PASSWORD") {
      setFailCount(n => n + 1);
      setError("Password errata. Riprova.");
      return;
    }

    // LOGIN OK
    if (data.ok) {
      setTimeout(() => {
        window.location.href = "/dashboard";
      }, 80);
    }
  }

  return (
    <main className="min-h-screen flex items-center justify-center bg-gray-100 p-6">
      <div className="bg-white p-8 rounded-xl shadow-lg max-w-md w-full">
        <h1 className="text-3xl font-bold mb-6 text-center">Accedi</h1>

        <form onSubmit={handleSubmit} className="flex flex-col gap-4">
          <input
            type="email"
            placeholder="Email"
            className="p-3 border rounded-lg"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            required
          />

          <input
            type="password"
            placeholder="Password"
            className="p-3 border rounded-lg"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            required
          />

          {error && (
            <div className="text-red-600 text-sm text-center">{error}</div>
          )}

          <button
            type="submit"
            className="py-3 bg-black text-white rounded-lg font-semibold hover:bg-gray-800 transition"
          >
            Accedi
          </button>
        </form>

        {/* EMAIL NON REGISTRATA */}
        {error === "Questa email non risulta registrata." && (
          <div className="mt-5 text-center">
            <p className="mb-3">Vuoi creare un nuovo account?</p>
            <a
              href={`/register?email=${encodeURIComponent(email)}`}
              className="text-blue-600 underline font-semibold"
            >
              Registrati con questa email
            </a>
          </div>
        )}

        {/* DOPO 3 ERRORI PASSWORD → PASSWORD RESET */}
        {failCount >= 3 && error !== "Questa email non risulta registrata." && (
          <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-center">
            <p className="text-yellow-800 font-medium mb-2">
              Problemi ad accedere?
            </p>
            <a
              href={`/forgot-password?email=${encodeURIComponent(email)}`}
              className="text-blue-600 underline font-semibold"
            >
              Reimposta la password
            </a>
          </div>
        )}
      </div>
    </main>
  );
}
```

├─ app/page.tsx
```
"use client";

import { useRouter } from "next/navigation";

export default function Home() {
  const router = useRouter();

  return (
    <main
      className="w-full min-h-screen bg-cover bg-center flex flex-col items-center justify-center text-white"
      style={{
        backgroundImage: "url('/wellness-bg.jpg')",
      }}
    >
      <div className="bg-black/40 backdrop-blur-md px-10 py-12 rounded-2xl text-center shadow-xl max-w-md">
        <h1 className="text-4xl font-bold mb-4">Benvenuto in AGW</h1>
        <p className="text-lg mb-8 opacity-90">
          Il tuo percorso di crescita, benessere e disciplina inizia qui.
        </p>

        <div className="flex gap-4 justify-center">
          <button
            onClick={() => router.push("/login")}
            className="px-6 py-3 bg-white text-black text-lg rounded-lg font-semibold hover:bg-gray-200 transition"
          >
            Accedi
          </button>

          <button
            onClick={() => router.push("/register")}
            className="px-6 py-3 bg-blue-600 text-white text-lg rounded-lg font-semibold hover:bg-blue-700 transition"
          >
            Registrati
          </button>
        </div>
      </div>
    </main>
  );
}
```

├─ app/register/page.tsx
```
"use client";

import { useState } from "react";

export default function RegisterPage() {
  const [email, setEmail] = useState("");
  const [firstname, setFirstname] = useState("");
  const [lastname, setLastname] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");
  const [ok, setOk] = useState(false);

  async function handleRegister() {
    setError("");
    setOk(false);

    const res = await fetch("/api/user/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, firstname, lastname, password }),
    });

    const data = await res.json();

    if (!res.ok || !data.ok) {
      setError(data.error || "Registrazione fallita");
      return;
    }

    setOk(true);
  }

  return (
    <main className="min-h-screen flex items-center justify-center">
      <div className="w-full max-w-sm p-6 space-y-4 border rounded-lg bg-white">
        <h1 className="text-2xl font-bold text-center">Registrati</h1>

        <input className="w-full border px-3 py-2 rounded" placeholder="Nome" value={firstname} onChange={e => setFirstname(e.target.value)} />
        <input className="w-full border px-3 py-2 rounded" placeholder="Cognome" value={lastname} onChange={e => setLastname(e.target.value)} />
        <input className="w-full border px-3 py-2 rounded" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)} />
        <input className="w-full border px-3 py-2 rounded" placeholder="Password" type="password" value={password} onChange={e => setPassword(e.target.value)} />

        {error && <p className="text-sm text-red-600">{error}</p>}
        {ok && <p className="text-sm text-green-600">Registrazione completata. Ora puoi accedere.</p>}

        <button onClick={handleRegister} className="w-full py-2 bg-black text-white rounded">
          Crea account
        </button>
      </div>
    </main>
  );
}
```

├─ app/reset-password/page.tsx
```
"use client";
import { useState } from "react";

export default function ResetPasswordPage({ searchParams }: any) {
  const token = searchParams.token;
  const [done, setDone] = useState(false);

  async function handleSubmit(e: any) {
    e.preventDefault();
    const pass = e.target.password.value;

    const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/user/do-reset`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token, new_password: pass })
    });

    const data = await res.json();
    if (data.ok) setDone(true);
  }

  if (!token) return <p>Token mancante.</p>;

  return (
    <main className="p-8">
      <h1 className="text-xl font-bold mb-4">Imposta nuova password</h1>

      {done ? (
        <p>Password aggiornata. Ora puoi fare login.</p>
      ) : (
        <form onSubmit={handleSubmit} className="flex flex-col gap-3">
          <input type="password" name="password" placeholder="Nuova password" className="border p-2" />
          <button className="bg-green-600 text-white p-2 rounded">Aggiorna</button>
        </form>
      )}
    </main>
  );
}
```

├─ app/test-env/page.tsx
```

"use client";
import { useEffect } from "react";

export default function TestEnv() {
  useEffect(() => {
    console.log("NEXT_PUBLIC_API_URL =", process.env.NEXT_PUBLIC_API_URL);
  }, []);

  return <p>Controlla la console del browser</p>;
}
```

├─ lib/utils.ts
```typescript
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

├─ next-env.d.ts
```typescript
/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.
```

├─ next.config.ts
```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  experimental: {
    optimizeCss: true,
  },

  // Questa linea disabilita l'errore di Turbopack
  turbopack: {},
};

export default nextConfig;
```

├─ package-lock.json
```json
{
  "name": "agw-app",
  "version": "0.1.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "agw-app",
      "version": "0.1.0",
      "dependencies": {
        "@radix-ui/react-dialog": "^1.1.15",
        "@radix-ui/react-slot": "^1.2.4",
        "class-variance-authority": "^0.7.1",
        "clsx": "^2.1.1",
        "lucide-react": "^0.554.0",
        "next": "16.0.3",
        "next-pwa": "^5.6.0",
        "next-themes": "^0.4.6",
        "react": "19.2.0",
        "react-dom": "19.2.0",
        "sonner": "^2.0.7",
        "tailwind-merge": "^3.4.0"
      },
      "devDependencies": {
        "@types/node": "^20",
        "@types/react": "^19",
        "@types/react-dom": "^19",
        "autoprefixer": "^10.4.22",
        "eslint": "^9",
        "eslint-config-next": "16.0.3",
        "postcss": "^8.5.6",
        "tailwindcss": "^3.4.18",
        "tw-animate-css": "^1.4.0",
        "typescript": "^5"
      }
    },
    "node_modules/@alloc/quick-lru": {
      "version": "5.2.0",
      "resolved": "https://registry.npmjs.org/@alloc/quick-lru/-/quick-lru-5.2.0.tgz",
      "integrity": "sha512-UrcABB+4bUrFABwbluTIBErXwvbsU/V7TZWfmbgJfbkwiBuziS9gxdODUyuiecfdGQ85jglMW6juS3+z5TsKLw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/@babel/code-frame": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/code-frame/-/code-frame-7.27.1.tgz",
      "integrity": "sha512-cjQ7ZlQ0Mv3b47hABuTevyTuYN4i+loJKGeV9flcCgIK37cCXRh+L1bd3iBHlynerhQ7BhCkn2BPbQUL+rGqFg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-validator-identifier": "^7.27.1",
        "js-tokens": "^4.0.0",
        "picocolors": "^1.1.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/compat-data": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/compat-data/-/compat-data-7.28.5.tgz",
      "integrity": "sha512-6uFXyCayocRbqhZOB+6XcuZbkMNimwfVGFji8CTZnCzOHVGvDqzvitu1re2AU5LROliz7eQPhB8CpAMvnx9EjA==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/core": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/core/-/core-7.28.5.tgz",
      "integrity": "sha512-e7jT4DxYvIDLk1ZHmU/m/mB19rex9sv0c2ftBtjSBv+kVM/902eh0fINUzD7UwLLNR+jU585GxUJ8/EBfAM5fw==",
      "license": "MIT",
      "peer": true,
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/generator": "^7.28.5",
        "@babel/helper-compilation-targets": "^7.27.2",
        "@babel/helper-module-transforms": "^7.28.3",
        "@babel/helpers": "^7.28.4",
        "@babel/parser": "^7.28.5",
        "@babel/template": "^7.27.2",
        "@babel/traverse": "^7.28.5",
        "@babel/types": "^7.28.5",
        "@jridgewell/remapping": "^2.3.5",
        "convert-source-map": "^2.0.0",
        "debug": "^4.1.0",
        "gensync": "^1.0.0-beta.2",
        "json5": "^2.2.3",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/babel"
      }
    },
    "node_modules/@babel/generator": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/generator/-/generator-7.28.5.tgz",
      "integrity": "sha512-3EwLFhZ38J4VyIP6WNtt2kUdW9dokXA9Cr4IVIFHuCpZ3H8/YFOl5JjZHisrn1fATPBmKKqXzDFvh9fUwHz6CQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.28.5",
        "@babel/types": "^7.28.5",
        "@jridgewell/gen-mapping": "^0.3.12",
        "@jridgewell/trace-mapping": "^0.3.28",
        "jsesc": "^3.0.2"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-annotate-as-pure": {
      "version": "7.27.3",
      "resolved": "https://registry.npmjs.org/@babel/helper-annotate-as-pure/-/helper-annotate-as-pure-7.27.3.tgz",
      "integrity": "sha512-fXSwMQqitTGeHLBC08Eq5yXz2m37E4pJX1qAU1+2cNedz/ifv/bVXft90VeSav5nFO61EcNgwr0aJxbyPaWBPg==",
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.27.3"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-compilation-targets": {
      "version": "7.27.2",
      "resolved": "https://registry.npmjs.org/@babel/helper-compilation-targets/-/helper-compilation-targets-7.27.2.tgz",
      "integrity": "sha512-2+1thGUUWWjLTYTHZWK1n8Yga0ijBz1XAhUXcKy81rd5g6yh7hGqMp45v7cadSbEHc9G3OTv45SyneRN3ps4DQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/compat-data": "^7.27.2",
        "@babel/helper-validator-option": "^7.27.1",
        "browserslist": "^4.24.0",
        "lru-cache": "^5.1.1",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-create-class-features-plugin": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/helper-create-class-features-plugin/-/helper-create-class-features-plugin-7.28.5.tgz",
      "integrity": "sha512-q3WC4JfdODypvxArsJQROfupPBq9+lMwjKq7C33GhbFYJsufD0yd/ziwD+hJucLeWsnFPWZjsU2DNFqBPE7jwQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-annotate-as-pure": "^7.27.3",
        "@babel/helper-member-expression-to-functions": "^7.28.5",
        "@babel/helper-optimise-call-expression": "^7.27.1",
        "@babel/helper-replace-supers": "^7.27.1",
        "@babel/helper-skip-transparent-expression-wrappers": "^7.27.1",
        "@babel/traverse": "^7.28.5",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/helper-create-regexp-features-plugin": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/helper-create-regexp-features-plugin/-/helper-create-regexp-features-plugin-7.28.5.tgz",
      "integrity": "sha512-N1EhvLtHzOvj7QQOUCCS3NrPJP8c5W6ZXCHDn7Yialuy1iu4r5EmIYkXlKNqT99Ciw+W0mDqWoR6HWMZlFP3hw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-annotate-as-pure": "^7.27.3",
        "regexpu-core": "^6.3.1",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/helper-define-polyfill-provider": {
      "version": "0.6.5",
      "resolved": "https://registry.npmjs.org/@babel/helper-define-polyfill-provider/-/helper-define-polyfill-provider-0.6.5.tgz",
      "integrity": "sha512-uJnGFcPsWQK8fvjgGP5LZUZZsYGIoPeRjSF5PGwrelYgq7Q15/Ft9NGFp1zglwgIv//W0uG4BevRuSJRyylZPg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-compilation-targets": "^7.27.2",
        "@babel/helper-plugin-utils": "^7.27.1",
        "debug": "^4.4.1",
        "lodash.debounce": "^4.0.8",
        "resolve": "^1.22.10"
      },
      "peerDependencies": {
        "@babel/core": "^7.4.0 || ^8.0.0-0 <8.0.0"
      }
    },
    "node_modules/@babel/helper-globals": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/helper-globals/-/helper-globals-7.28.0.tgz",
      "integrity": "sha512-+W6cISkXFa1jXsDEdYA8HeevQT/FULhxzR99pxphltZcVaugps53THCeiWA8SguxxpSp3gKPiuYfSWopkLQ4hw==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-member-expression-to-functions": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/helper-member-expression-to-functions/-/helper-member-expression-to-functions-7.28.5.tgz",
      "integrity": "sha512-cwM7SBRZcPCLgl8a7cY0soT1SptSzAlMH39vwiRpOQkJlh53r5hdHwLSCZpQdVLT39sZt+CRpNwYG4Y2v77atg==",
      "license": "MIT",
      "dependencies": {
        "@babel/traverse": "^7.28.5",
        "@babel/types": "^7.28.5"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-module-imports": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-module-imports/-/helper-module-imports-7.27.1.tgz",
      "integrity": "sha512-0gSFWUPNXNopqtIPQvlD5WgXYI5GY2kP2cCvoT8kczjbfcfuIljTbcWrulD1CIPIX2gt1wghbDy08yE1p+/r3w==",
      "license": "MIT",
      "dependencies": {
        "@babel/traverse": "^7.27.1",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-module-transforms": {
      "version": "7.28.3",
      "resolved": "https://registry.npmjs.org/@babel/helper-module-transforms/-/helper-module-transforms-7.28.3.tgz",
      "integrity": "sha512-gytXUbs8k2sXS9PnQptz5o0QnpLL51SwASIORY6XaBKF88nsOT0Zw9szLqlSGQDP/4TljBAD5y98p2U1fqkdsw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-imports": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.27.1",
        "@babel/traverse": "^7.28.3"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/helper-optimise-call-expression": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-optimise-call-expression/-/helper-optimise-call-expression-7.27.1.tgz",
      "integrity": "sha512-URMGH08NzYFhubNSGJrpUEphGKQwMQYBySzat5cAByY1/YgIRkULnIy3tAMeszlL/so2HbeilYloUmSpd7GdVw==",
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-plugin-utils": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-plugin-utils/-/helper-plugin-utils-7.27.1.tgz",
      "integrity": "sha512-1gn1Up5YXka3YYAHGKpbideQ5Yjf1tDa9qYcgysz+cNCXukyLl6DjPXhD3VRwSb8c0J9tA4b2+rHEZtc6R0tlw==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-remap-async-to-generator": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-remap-async-to-generator/-/helper-remap-async-to-generator-7.27.1.tgz",
      "integrity": "sha512-7fiA521aVw8lSPeI4ZOD3vRFkoqkJcS+z4hFo82bFSH/2tNd6eJ5qCVMS5OzDmZh/kaHQeBaeyxK6wljcPtveA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-annotate-as-pure": "^7.27.1",
        "@babel/helper-wrap-function": "^7.27.1",
        "@babel/traverse": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/helper-replace-supers": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-replace-supers/-/helper-replace-supers-7.27.1.tgz",
      "integrity": "sha512-7EHz6qDZc8RYS5ElPoShMheWvEgERonFCs7IAonWLLUTXW59DP14bCZt89/GKyreYn8g3S83m21FelHKbeDCKA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-member-expression-to-functions": "^7.27.1",
        "@babel/helper-optimise-call-expression": "^7.27.1",
        "@babel/traverse": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/helper-skip-transparent-expression-wrappers": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-skip-transparent-expression-wrappers/-/helper-skip-transparent-expression-wrappers-7.27.1.tgz",
      "integrity": "sha512-Tub4ZKEXqbPjXgWLl2+3JpQAYBJ8+ikpQ2Ocj/q/r0LwE3UhENh7EUabyHjz2kCEsrRY83ew2DQdHluuiDQFzg==",
      "license": "MIT",
      "dependencies": {
        "@babel/traverse": "^7.27.1",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-string-parser": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-string-parser/-/helper-string-parser-7.27.1.tgz",
      "integrity": "sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-validator-identifier": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/helper-validator-identifier/-/helper-validator-identifier-7.28.5.tgz",
      "integrity": "sha512-qSs4ifwzKJSV39ucNjsvc6WVHs6b7S03sOh2OcHF9UHfVPqWWALUsNUVzhSBiItjRZoLHx7nIarVjqKVusUZ1Q==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-validator-option": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-validator-option/-/helper-validator-option-7.27.1.tgz",
      "integrity": "sha512-YvjJow9FxbhFFKDSuFnVCe2WxXk1zWc22fFePVNEaWJEu8IrZVlda6N0uHwzZrUM1il7NC9Mlp4MaJYbYd9JSg==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-wrap-function": {
      "version": "7.28.3",
      "resolved": "https://registry.npmjs.org/@babel/helper-wrap-function/-/helper-wrap-function-7.28.3.tgz",
      "integrity": "sha512-zdf983tNfLZFletc0RRXYrHrucBEg95NIFMkn6K9dbeMYnsgHaSBGcQqdsCSStG2PYwRre0Qc2NNSCXbG+xc6g==",
      "license": "MIT",
      "dependencies": {
        "@babel/template": "^7.27.2",
        "@babel/traverse": "^7.28.3",
        "@babel/types": "^7.28.2"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helpers": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/helpers/-/helpers-7.28.4.tgz",
      "integrity": "sha512-HFN59MmQXGHVyYadKLVumYsA9dBFun/ldYxipEjzA4196jpLZd8UjEEBLkbEkvfYreDqJhZxYAWFPtrfhNpj4w==",
      "license": "MIT",
      "dependencies": {
        "@babel/template": "^7.27.2",
        "@babel/types": "^7.28.4"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/parser": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/parser/-/parser-7.28.5.tgz",
      "integrity": "sha512-KKBU1VGYR7ORr3At5HAtUQ+TV3SzRCXmA/8OdDZiLDBIZxVyzXuztPjfLd3BV1PRAQGCMWWSHYhL0F8d5uHBDQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.28.5"
      },
      "bin": {
        "parser": "bin/babel-parser.js"
      },
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@babel/plugin-bugfix-firefox-class-in-computed-class-key": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/plugin-bugfix-firefox-class-in-computed-class-key/-/plugin-bugfix-firefox-class-in-computed-class-key-7.28.5.tgz",
      "integrity": "sha512-87GDMS3tsmMSi/3bWOte1UblL+YUTFMV8SZPZ2eSEL17s74Cw/l63rR6NmGVKMYW2GYi85nE+/d6Hw5N0bEk2Q==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/traverse": "^7.28.5"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/plugin-bugfix-safari-class-field-initializer-scope": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-bugfix-safari-class-field-initializer-scope/-/plugin-bugfix-safari-class-field-initializer-scope-7.27.1.tgz",
      "integrity": "sha512-qNeq3bCKnGgLkEXUuFry6dPlGfCdQNZbn7yUAPCInwAJHMU7THJfrBSozkcWq5sNM6RcF3S8XyQL2A52KNR9IA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/plugin-bugfix-safari-id-destructuring-collision-in-function-expression": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-bugfix-safari-id-destructuring-collision-in-function-expression/-/plugin-bugfix-safari-id-destructuring-collision-in-function-expression-7.27.1.tgz",
      "integrity": "sha512-g4L7OYun04N1WyqMNjldFwlfPCLVkgB54A/YCXICZYBsvJJE3kByKv9c9+R/nAfmIfjl2rKYLNyMHboYbZaWaA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/plugin-bugfix-v8-spread-parameters-in-optional-chaining": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-bugfix-v8-spread-parameters-in-optional-chaining/-/plugin-bugfix-v8-spread-parameters-in-optional-chaining-7.27.1.tgz",
      "integrity": "sha512-oO02gcONcD5O1iTLi/6frMJBIwWEHceWGSGqrpCmEL8nogiS6J9PBlE48CaK20/Jx1LuRml9aDftLgdjXT8+Cw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-skip-transparent-expression-wrappers": "^7.27.1",
        "@babel/plugin-transform-optional-chaining": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.13.0"
      }
    },
    "node_modules/@babel/plugin-bugfix-v8-static-class-fields-redefine-readonly": {
      "version": "7.28.3",
      "resolved": "https://registry.npmjs.org/@babel/plugin-bugfix-v8-static-class-fields-redefine-readonly/-/plugin-bugfix-v8-static-class-fields-redefine-readonly-7.28.3.tgz",
      "integrity": "sha512-b6YTX108evsvE4YgWyQ921ZAFFQm3Bn+CA3+ZXlNVnPhx+UfsVURoPjfGAPCjBgrqo30yX/C2nZGX96DxvR9Iw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/traverse": "^7.28.3"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/plugin-proposal-private-property-in-object": {
      "version": "7.21.0-placeholder-for-preset-env.2",
      "resolved": "https://registry.npmjs.org/@babel/plugin-proposal-private-property-in-object/-/plugin-proposal-private-property-in-object-7.21.0-placeholder-for-preset-env.2.tgz",
      "integrity": "sha512-SOSkfJDddaM7mak6cPEpswyTRnuRltl429hMraQEglW+OkovnCzsiszTmsrlY//qLFjCpQDFRvjdm2wA5pPm9w==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-syntax-import-assertions": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-syntax-import-assertions/-/plugin-syntax-import-assertions-7.27.1.tgz",
      "integrity": "sha512-UT/Jrhw57xg4ILHLFnzFpPDlMbcdEicaAtjPQpbj9wa8T4r5KVWCimHcL/460g8Ht0DMxDyjsLgiWSkVjnwPFg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-syntax-import-attributes": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-syntax-import-attributes/-/plugin-syntax-import-attributes-7.27.1.tgz",
      "integrity": "sha512-oFT0FrKHgF53f4vOsZGi2Hh3I35PfSmVs4IBFLFj4dnafP+hIWDLg3VyKmUHfLoLHlyxY4C7DGtmHuJgn+IGww==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-syntax-unicode-sets-regex": {
      "version": "7.18.6",
      "resolved": "https://registry.npmjs.org/@babel/plugin-syntax-unicode-sets-regex/-/plugin-syntax-unicode-sets-regex-7.18.6.tgz",
      "integrity": "sha512-727YkEAPwSIQTv5im8QHz3upqp92JTWhidIC81Tdx4VJYIte/VndKf1qKrfnnhPLiPghStWfvC/iFaMCQu7Nqg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-regexp-features-plugin": "^7.18.6",
        "@babel/helper-plugin-utils": "^7.18.6"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/plugin-transform-arrow-functions": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-arrow-functions/-/plugin-transform-arrow-functions-7.27.1.tgz",
      "integrity": "sha512-8Z4TGic6xW70FKThA5HYEKKyBpOOsucTOD1DjU3fZxDg+K3zBJcXMFnt/4yQiZnf5+MiOMSXQ9PaEK/Ilh1DeA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-async-generator-functions": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-async-generator-functions/-/plugin-transform-async-generator-functions-7.28.0.tgz",
      "integrity": "sha512-BEOdvX4+M765icNPZeidyADIvQ1m1gmunXufXxvRESy/jNNyfovIqUyE7MVgGBjWktCoJlzvFA1To2O4ymIO3Q==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-remap-async-to-generator": "^7.27.1",
        "@babel/traverse": "^7.28.0"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-async-to-generator": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-async-to-generator/-/plugin-transform-async-to-generator-7.27.1.tgz",
      "integrity": "sha512-NREkZsZVJS4xmTr8qzE5y8AfIPqsdQfRuUiLRTEzb7Qii8iFWCyDKaUV2c0rCuh4ljDZ98ALHP/PetiBV2nddA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-imports": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-remap-async-to-generator": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-block-scoped-functions": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-block-scoped-functions/-/plugin-transform-block-scoped-functions-7.27.1.tgz",
      "integrity": "sha512-cnqkuOtZLapWYZUYM5rVIdv1nXYuFVIltZ6ZJ7nIj585QsjKM5dhL2Fu/lICXZ1OyIAFc7Qy+bvDAtTXqGrlhg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-block-scoping": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-block-scoping/-/plugin-transform-block-scoping-7.28.5.tgz",
      "integrity": "sha512-45DmULpySVvmq9Pj3X9B+62Xe+DJGov27QravQJU1LLcapR6/10i+gYVAucGGJpHBp5mYxIMK4nDAT/QDLr47g==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-class-properties": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-class-properties/-/plugin-transform-class-properties-7.27.1.tgz",
      "integrity": "sha512-D0VcalChDMtuRvJIu3U/fwWjf8ZMykz5iZsg77Nuj821vCKI3zCyRLwRdWbsuJ/uRwZhZ002QtCqIkwC/ZkvbA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-class-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-class-static-block": {
      "version": "7.28.3",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-class-static-block/-/plugin-transform-class-static-block-7.28.3.tgz",
      "integrity": "sha512-LtPXlBbRoc4Njl/oh1CeD/3jC+atytbnf/UqLoqTDcEYGUPj022+rvfkbDYieUrSj3CaV4yHDByPE+T2HwfsJg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-class-features-plugin": "^7.28.3",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.12.0"
      }
    },
    "node_modules/@babel/plugin-transform-classes": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-classes/-/plugin-transform-classes-7.28.4.tgz",
      "integrity": "sha512-cFOlhIYPBv/iBoc+KS3M6et2XPtbT2HiCRfBXWtfpc9OAyostldxIf9YAYB6ypURBBbx+Qv6nyrLzASfJe+hBA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-annotate-as-pure": "^7.27.3",
        "@babel/helper-compilation-targets": "^7.27.2",
        "@babel/helper-globals": "^7.28.0",
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-replace-supers": "^7.27.1",
        "@babel/traverse": "^7.28.4"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-computed-properties": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-computed-properties/-/plugin-transform-computed-properties-7.27.1.tgz",
      "integrity": "sha512-lj9PGWvMTVksbWiDT2tW68zGS/cyo4AkZ/QTp0sQT0mjPopCmrSkzxeXkznjqBxzDI6TclZhOJbBmbBLjuOZUw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/template": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-destructuring": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-destructuring/-/plugin-transform-destructuring-7.28.5.tgz",
      "integrity": "sha512-Kl9Bc6D0zTUcFUvkNuQh4eGXPKKNDOJQXVyyM4ZAQPMveniJdxi8XMJwLo+xSoW3MIq81bD33lcUe9kZpl0MCw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/traverse": "^7.28.5"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-dotall-regex": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-dotall-regex/-/plugin-transform-dotall-regex-7.27.1.tgz",
      "integrity": "sha512-gEbkDVGRvjj7+T1ivxrfgygpT7GUd4vmODtYpbs0gZATdkX8/iSnOtZSxiZnsgm1YjTgjI6VKBGSJJevkrclzw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-regexp-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-duplicate-keys": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-duplicate-keys/-/plugin-transform-duplicate-keys-7.27.1.tgz",
      "integrity": "sha512-MTyJk98sHvSs+cvZ4nOauwTTG1JeonDjSGvGGUNHreGQns+Mpt6WX/dVzWBHgg+dYZhkC4X+zTDfkTU+Vy9y7Q==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-duplicate-named-capturing-groups-regex": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-duplicate-named-capturing-groups-regex/-/plugin-transform-duplicate-named-capturing-groups-regex-7.27.1.tgz",
      "integrity": "sha512-hkGcueTEzuhB30B3eJCbCYeCaaEQOmQR0AdvzpD4LoN0GXMWzzGSuRrxR2xTnCrvNbVwK9N6/jQ92GSLfiZWoQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-regexp-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/plugin-transform-dynamic-import": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-dynamic-import/-/plugin-transform-dynamic-import-7.27.1.tgz",
      "integrity": "sha512-MHzkWQcEmjzzVW9j2q8LGjwGWpG2mjwaaB0BNQwst3FIjqsg8Ct/mIZlvSPJvfi9y2AC8mi/ktxbFVL9pZ1I4A==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-explicit-resource-management": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-explicit-resource-management/-/plugin-transform-explicit-resource-management-7.28.0.tgz",
      "integrity": "sha512-K8nhUcn3f6iB+P3gwCv/no7OdzOZQcKchW6N389V6PD8NUWKZHzndOd9sPDVbMoBsbmjMqlB4L9fm+fEFNVlwQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/plugin-transform-destructuring": "^7.28.0"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-exponentiation-operator": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-exponentiation-operator/-/plugin-transform-exponentiation-operator-7.28.5.tgz",
      "integrity": "sha512-D4WIMaFtwa2NizOp+dnoFjRez/ClKiC2BqqImwKd1X28nqBtZEyCYJ2ozQrrzlxAFrcrjxo39S6khe9RNDlGzw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-export-namespace-from": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-export-namespace-from/-/plugin-transform-export-namespace-from-7.27.1.tgz",
      "integrity": "sha512-tQvHWSZ3/jH2xuq/vZDy0jNn+ZdXJeM8gHvX4lnJmsc3+50yPlWdZXIc5ay+umX+2/tJIqHqiEqcJvxlmIvRvQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-for-of": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-for-of/-/plugin-transform-for-of-7.27.1.tgz",
      "integrity": "sha512-BfbWFFEJFQzLCQ5N8VocnCtA8J1CLkNTe2Ms2wocj75dd6VpiqS5Z5quTYcUoo4Yq+DN0rtikODccuv7RU81sw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-skip-transparent-expression-wrappers": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-function-name": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-function-name/-/plugin-transform-function-name-7.27.1.tgz",
      "integrity": "sha512-1bQeydJF9Nr1eBCMMbC+hdwmRlsv5XYOMu03YSWFwNs0HsAmtSxxF1fyuYPqemVldVyFmlCU7w8UE14LupUSZQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-compilation-targets": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/traverse": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-json-strings": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-json-strings/-/plugin-transform-json-strings-7.27.1.tgz",
      "integrity": "sha512-6WVLVJiTjqcQauBhn1LkICsR2H+zm62I3h9faTDKt1qP4jn2o72tSvqMwtGFKGTpojce0gJs+76eZ2uCHRZh0Q==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-literals": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-literals/-/plugin-transform-literals-7.27.1.tgz",
      "integrity": "sha512-0HCFSepIpLTkLcsi86GG3mTUzxV5jpmbv97hTETW3yzrAij8aqlD36toB1D0daVFJM8NK6GvKO0gslVQmm+zZA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-logical-assignment-operators": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-logical-assignment-operators/-/plugin-transform-logical-assignment-operators-7.28.5.tgz",
      "integrity": "sha512-axUuqnUTBuXyHGcJEVVh9pORaN6wC5bYfE7FGzPiaWa3syib9m7g+/IT/4VgCOe2Upef43PHzeAvcrVek6QuuA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-member-expression-literals": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-member-expression-literals/-/plugin-transform-member-expression-literals-7.27.1.tgz",
      "integrity": "sha512-hqoBX4dcZ1I33jCSWcXrP+1Ku7kdqXf1oeah7ooKOIiAdKQ+uqftgCFNOSzA5AMS2XIHEYeGFg4cKRCdpxzVOQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-modules-amd": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-modules-amd/-/plugin-transform-modules-amd-7.27.1.tgz",
      "integrity": "sha512-iCsytMg/N9/oFq6n+gFTvUYDZQOMK5kEdeYxmxt91fcJGycfxVP9CnrxoliM0oumFERba2i8ZtwRUCMhvP1LnA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-transforms": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-modules-commonjs": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-modules-commonjs/-/plugin-transform-modules-commonjs-7.27.1.tgz",
      "integrity": "sha512-OJguuwlTYlN0gBZFRPqwOGNWssZjfIUdS7HMYtN8c1KmwpwHFBwTeFZrg9XZa+DFTitWOW5iTAG7tyCUPsCCyw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-transforms": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-modules-systemjs": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-modules-systemjs/-/plugin-transform-modules-systemjs-7.28.5.tgz",
      "integrity": "sha512-vn5Jma98LCOeBy/KpeQhXcV2WZgaRUtjwQmjoBuLNlOmkg0fB5pdvYVeWRYI69wWKwK2cD1QbMiUQnoujWvrew==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-transforms": "^7.28.3",
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.28.5",
        "@babel/traverse": "^7.28.5"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-modules-umd": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-modules-umd/-/plugin-transform-modules-umd-7.27.1.tgz",
      "integrity": "sha512-iQBE/xC5BV1OxJbp6WG7jq9IWiD+xxlZhLrdwpPkTX3ydmXdvoCpyfJN7acaIBZaOqTfr76pgzqBJflNbeRK+w==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-transforms": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-named-capturing-groups-regex": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-named-capturing-groups-regex/-/plugin-transform-named-capturing-groups-regex-7.27.1.tgz",
      "integrity": "sha512-SstR5JYy8ddZvD6MhV0tM/j16Qds4mIpJTOd1Yu9J9pJjH93bxHECF7pgtc28XvkzTD6Pxcm/0Z73Hvk7kb3Ng==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-regexp-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/plugin-transform-new-target": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-new-target/-/plugin-transform-new-target-7.27.1.tgz",
      "integrity": "sha512-f6PiYeqXQ05lYq3TIfIDu/MtliKUbNwkGApPUvyo6+tc7uaR4cPjPe7DFPr15Uyycg2lZU6btZ575CuQoYh7MQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-nullish-coalescing-operator": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-nullish-coalescing-operator/-/plugin-transform-nullish-coalescing-operator-7.27.1.tgz",
      "integrity": "sha512-aGZh6xMo6q9vq1JGcw58lZ1Z0+i0xB2x0XaauNIUXd6O1xXc3RwoWEBlsTQrY4KQ9Jf0s5rgD6SiNkaUdJegTA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-numeric-separator": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-numeric-separator/-/plugin-transform-numeric-separator-7.27.1.tgz",
      "integrity": "sha512-fdPKAcujuvEChxDBJ5c+0BTaS6revLV7CJL08e4m3de8qJfNIuCc2nc7XJYOjBoTMJeqSmwXJ0ypE14RCjLwaw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-object-rest-spread": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-object-rest-spread/-/plugin-transform-object-rest-spread-7.28.4.tgz",
      "integrity": "sha512-373KA2HQzKhQCYiRVIRr+3MjpCObqzDlyrM6u4I201wL8Mp2wHf7uB8GhDwis03k2ti8Zr65Zyyqs1xOxUF/Ew==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-compilation-targets": "^7.27.2",
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/plugin-transform-destructuring": "^7.28.0",
        "@babel/plugin-transform-parameters": "^7.27.7",
        "@babel/traverse": "^7.28.4"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-object-super": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-object-super/-/plugin-transform-object-super-7.27.1.tgz",
      "integrity": "sha512-SFy8S9plRPbIcxlJ8A6mT/CxFdJx/c04JEctz4jf8YZaVS2px34j7NXRrlGlHkN/M2gnpL37ZpGRGVFLd3l8Ng==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-replace-supers": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-optional-catch-binding": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-optional-catch-binding/-/plugin-transform-optional-catch-binding-7.27.1.tgz",
      "integrity": "sha512-txEAEKzYrHEX4xSZN4kJ+OfKXFVSWKB2ZxM9dpcE3wT7smwkNmXo5ORRlVzMVdJbD+Q8ILTgSD7959uj+3Dm3Q==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-optional-chaining": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-optional-chaining/-/plugin-transform-optional-chaining-7.28.5.tgz",
      "integrity": "sha512-N6fut9IZlPnjPwgiQkXNhb+cT8wQKFlJNqcZkWlcTqkcqx6/kU4ynGmLFoa4LViBSirn05YAwk+sQBbPfxtYzQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-skip-transparent-expression-wrappers": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-parameters": {
      "version": "7.27.7",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-parameters/-/plugin-transform-parameters-7.27.7.tgz",
      "integrity": "sha512-qBkYTYCb76RRxUM6CcZA5KRu8K4SM8ajzVeUgVdMVO9NN9uI/GaVmBg/WKJJGnNokV9SY8FxNOVWGXzqzUidBg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-private-methods": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-private-methods/-/plugin-transform-private-methods-7.27.1.tgz",
      "integrity": "sha512-10FVt+X55AjRAYI9BrdISN9/AQWHqldOeZDUoLyif1Kn05a56xVBXb8ZouL8pZ9jem8QpXaOt8TS7RHUIS+GPA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-class-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-private-property-in-object": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-private-property-in-object/-/plugin-transform-private-property-in-object-7.27.1.tgz",
      "integrity": "sha512-5J+IhqTi1XPa0DXF83jYOaARrX+41gOewWbkPyjMNRDqgOCqdffGh8L3f/Ek5utaEBZExjSAzcyjmV9SSAWObQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-annotate-as-pure": "^7.27.1",
        "@babel/helper-create-class-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-property-literals": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-property-literals/-/plugin-transform-property-literals-7.27.1.tgz",
      "integrity": "sha512-oThy3BCuCha8kDZ8ZkgOg2exvPYUlprMukKQXI1r1pJ47NCvxfkEy8vK+r/hT9nF0Aa4H1WUPZZjHTFtAhGfmQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-regenerator": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-regenerator/-/plugin-transform-regenerator-7.28.4.tgz",
      "integrity": "sha512-+ZEdQlBoRg9m2NnzvEeLgtvBMO4tkFBw5SQIUgLICgTrumLoU7lr+Oghi6km2PFj+dbUt2u1oby2w3BDO9YQnA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-regexp-modifiers": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-regexp-modifiers/-/plugin-transform-regexp-modifiers-7.27.1.tgz",
      "integrity": "sha512-TtEciroaiODtXvLZv4rmfMhkCv8jx3wgKpL68PuiPh2M4fvz5jhsA7697N1gMvkvr/JTF13DrFYyEbY9U7cVPA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-regexp-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/plugin-transform-reserved-words": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-reserved-words/-/plugin-transform-reserved-words-7.27.1.tgz",
      "integrity": "sha512-V2ABPHIJX4kC7HegLkYoDpfg9PVmuWy/i6vUM5eGK22bx4YVFD3M5F0QQnWQoDs6AGsUWTVOopBiMFQgHaSkVw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-shorthand-properties": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-shorthand-properties/-/plugin-transform-shorthand-properties-7.27.1.tgz",
      "integrity": "sha512-N/wH1vcn4oYawbJ13Y/FxcQrWk63jhfNa7jef0ih7PHSIHX2LB7GWE1rkPrOnka9kwMxb6hMl19p7lidA+EHmQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-spread": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-spread/-/plugin-transform-spread-7.27.1.tgz",
      "integrity": "sha512-kpb3HUqaILBJcRFVhFUs6Trdd4mkrzcGXss+6/mxUd273PfbWqSDHRzMT2234gIg2QYfAjvXLSquP1xECSg09Q==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-skip-transparent-expression-wrappers": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-sticky-regex": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-sticky-regex/-/plugin-transform-sticky-regex-7.27.1.tgz",
      "integrity": "sha512-lhInBO5bi/Kowe2/aLdBAawijx+q1pQzicSgnkB6dUPc1+RC8QmJHKf2OjvU+NZWitguJHEaEmbV6VWEouT58g==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-template-literals": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-template-literals/-/plugin-transform-template-literals-7.27.1.tgz",
      "integrity": "sha512-fBJKiV7F2DxZUkg5EtHKXQdbsbURW3DZKQUWphDum0uRP6eHGGa/He9mc0mypL680pb+e/lDIthRohlv8NCHkg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-typeof-symbol": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-typeof-symbol/-/plugin-transform-typeof-symbol-7.27.1.tgz",
      "integrity": "sha512-RiSILC+nRJM7FY5srIyc4/fGIwUhyDuuBSdWn4y6yT6gm652DpCHZjIipgn6B7MQ1ITOUnAKWixEUjQRIBIcLw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-unicode-escapes": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-unicode-escapes/-/plugin-transform-unicode-escapes-7.27.1.tgz",
      "integrity": "sha512-Ysg4v6AmF26k9vpfFuTZg8HRfVWzsh1kVfowA23y9j/Gu6dOuahdUVhkLqpObp3JIv27MLSii6noRnuKN8H0Mg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-unicode-property-regex": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-unicode-property-regex/-/plugin-transform-unicode-property-regex-7.27.1.tgz",
      "integrity": "sha512-uW20S39PnaTImxp39O5qFlHLS9LJEmANjMG7SxIhap8rCHqu0Ik+tLEPX5DKmHn6CsWQ7j3lix2tFOa5YtL12Q==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-regexp-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-unicode-regex": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-unicode-regex/-/plugin-transform-unicode-regex-7.27.1.tgz",
      "integrity": "sha512-xvINq24TRojDuyt6JGtHmkVkrfVV3FPT16uytxImLeBZqW3/H52yN+kM1MGuyPkIQxrzKwPHs5U/MP3qKyzkGw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-regexp-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-unicode-sets-regex": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-unicode-sets-regex/-/plugin-transform-unicode-sets-regex-7.27.1.tgz",
      "integrity": "sha512-EtkOujbc4cgvb0mlpQefi4NTPBzhSIevblFevACNLUspmrALgmEBdL/XfnyyITfd8fKBZrZys92zOWcik7j9Tw==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-create-regexp-features-plugin": "^7.27.1",
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/preset-env": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/preset-env/-/preset-env-7.28.5.tgz",
      "integrity": "sha512-S36mOoi1Sb6Fz98fBfE+UZSpYw5mJm0NUHtIKrOuNcqeFauy1J6dIvXm2KRVKobOSaGq4t/hBXdN4HGU3wL9Wg==",
      "license": "MIT",
      "dependencies": {
        "@babel/compat-data": "^7.28.5",
        "@babel/helper-compilation-targets": "^7.27.2",
        "@babel/helper-plugin-utils": "^7.27.1",
        "@babel/helper-validator-option": "^7.27.1",
        "@babel/plugin-bugfix-firefox-class-in-computed-class-key": "^7.28.5",
        "@babel/plugin-bugfix-safari-class-field-initializer-scope": "^7.27.1",
        "@babel/plugin-bugfix-safari-id-destructuring-collision-in-function-expression": "^7.27.1",
        "@babel/plugin-bugfix-v8-spread-parameters-in-optional-chaining": "^7.27.1",
        "@babel/plugin-bugfix-v8-static-class-fields-redefine-readonly": "^7.28.3",
        "@babel/plugin-proposal-private-property-in-object": "7.21.0-placeholder-for-preset-env.2",
        "@babel/plugin-syntax-import-assertions": "^7.27.1",
        "@babel/plugin-syntax-import-attributes": "^7.27.1",
        "@babel/plugin-syntax-unicode-sets-regex": "^7.18.6",
        "@babel/plugin-transform-arrow-functions": "^7.27.1",
        "@babel/plugin-transform-async-generator-functions": "^7.28.0",
        "@babel/plugin-transform-async-to-generator": "^7.27.1",
        "@babel/plugin-transform-block-scoped-functions": "^7.27.1",
        "@babel/plugin-transform-block-scoping": "^7.28.5",
        "@babel/plugin-transform-class-properties": "^7.27.1",
        "@babel/plugin-transform-class-static-block": "^7.28.3",
        "@babel/plugin-transform-classes": "^7.28.4",
        "@babel/plugin-transform-computed-properties": "^7.27.1",
        "@babel/plugin-transform-destructuring": "^7.28.5",
        "@babel/plugin-transform-dotall-regex": "^7.27.1",
        "@babel/plugin-transform-duplicate-keys": "^7.27.1",
        "@babel/plugin-transform-duplicate-named-capturing-groups-regex": "^7.27.1",
        "@babel/plugin-transform-dynamic-import": "^7.27.1",
        "@babel/plugin-transform-explicit-resource-management": "^7.28.0",
        "@babel/plugin-transform-exponentiation-operator": "^7.28.5",
        "@babel/plugin-transform-export-namespace-from": "^7.27.1",
        "@babel/plugin-transform-for-of": "^7.27.1",
        "@babel/plugin-transform-function-name": "^7.27.1",
        "@babel/plugin-transform-json-strings": "^7.27.1",
        "@babel/plugin-transform-literals": "^7.27.1",
        "@babel/plugin-transform-logical-assignment-operators": "^7.28.5",
        "@babel/plugin-transform-member-expression-literals": "^7.27.1",
        "@babel/plugin-transform-modules-amd": "^7.27.1",
        "@babel/plugin-transform-modules-commonjs": "^7.27.1",
        "@babel/plugin-transform-modules-systemjs": "^7.28.5",
        "@babel/plugin-transform-modules-umd": "^7.27.1",
        "@babel/plugin-transform-named-capturing-groups-regex": "^7.27.1",
        "@babel/plugin-transform-new-target": "^7.27.1",
        "@babel/plugin-transform-nullish-coalescing-operator": "^7.27.1",
        "@babel/plugin-transform-numeric-separator": "^7.27.1",
        "@babel/plugin-transform-object-rest-spread": "^7.28.4",
        "@babel/plugin-transform-object-super": "^7.27.1",
        "@babel/plugin-transform-optional-catch-binding": "^7.27.1",
        "@babel/plugin-transform-optional-chaining": "^7.28.5",
        "@babel/plugin-transform-parameters": "^7.27.7",
        "@babel/plugin-transform-private-methods": "^7.27.1",
        "@babel/plugin-transform-private-property-in-object": "^7.27.1",
        "@babel/plugin-transform-property-literals": "^7.27.1",
        "@babel/plugin-transform-regenerator": "^7.28.4",
        "@babel/plugin-transform-regexp-modifiers": "^7.27.1",
        "@babel/plugin-transform-reserved-words": "^7.27.1",
        "@babel/plugin-transform-shorthand-properties": "^7.27.1",
        "@babel/plugin-transform-spread": "^7.27.1",
        "@babel/plugin-transform-sticky-regex": "^7.27.1",
        "@babel/plugin-transform-template-literals": "^7.27.1",
        "@babel/plugin-transform-typeof-symbol": "^7.27.1",
        "@babel/plugin-transform-unicode-escapes": "^7.27.1",
        "@babel/plugin-transform-unicode-property-regex": "^7.27.1",
        "@babel/plugin-transform-unicode-regex": "^7.27.1",
        "@babel/plugin-transform-unicode-sets-regex": "^7.27.1",
        "@babel/preset-modules": "0.1.6-no-external-plugins",
        "babel-plugin-polyfill-corejs2": "^0.4.14",
        "babel-plugin-polyfill-corejs3": "^0.13.0",
        "babel-plugin-polyfill-regenerator": "^0.6.5",
        "core-js-compat": "^3.43.0",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/preset-modules": {
      "version": "0.1.6-no-external-plugins",
      "resolved": "https://registry.npmjs.org/@babel/preset-modules/-/preset-modules-0.1.6-no-external-plugins.tgz",
      "integrity": "sha512-HrcgcIESLm9aIR842yhJ5RWan/gebQUJ6E/E5+rf0y9o6oj7w0Br+sWuL6kEQ/o/AdfvR1Je9jG18/gnpwjEyA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.0.0",
        "@babel/types": "^7.4.4",
        "esutils": "^2.0.2"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0 || ^8.0.0-0 <8.0.0"
      }
    },
    "node_modules/@babel/runtime": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/runtime/-/runtime-7.28.4.tgz",
      "integrity": "sha512-Q/N6JNWvIvPnLDvjlE1OUBLPQHH6l3CltCEsHIujp45zQUSSh8K+gHnaEX45yAT1nyngnINhvWtzN+Nb9D8RAQ==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/template": {
      "version": "7.27.2",
      "resolved": "https://registry.npmjs.org/@babel/template/-/template-7.27.2.tgz",
      "integrity": "sha512-LPDZ85aEJyYSd18/DkjNh4/y1ntkE5KwUHWTiqgRxruuZL2F1yuHligVHLvcHY2vMHXttKFpJn6LwfI7cw7ODw==",
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/parser": "^7.27.2",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/traverse": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/traverse/-/traverse-7.28.5.tgz",
      "integrity": "sha512-TCCj4t55U90khlYkVV/0TfkJkAkUg3jZFA3Neb7unZT8CPok7iiRfaX0F+WnqWqt7OxhOn0uBKXCw4lbL8W0aQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/generator": "^7.28.5",
        "@babel/helper-globals": "^7.28.0",
        "@babel/parser": "^7.28.5",
        "@babel/template": "^7.27.2",
        "@babel/types": "^7.28.5",
        "debug": "^4.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/types": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/types/-/types-7.28.5.tgz",
      "integrity": "sha512-qQ5m48eI/MFLQ5PxQj4PFaprjyCTLI37ElWMmNs0K8Lk3dVeOdNpB3ks8jc7yM5CDmVC73eMVk/trk3fgmrUpA==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-string-parser": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.28.5"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@emnapi/core": {
      "version": "1.7.1",
      "resolved": "https://registry.npmjs.org/@emnapi/core/-/core-1.7.1.tgz",
      "integrity": "sha512-o1uhUASyo921r2XtHYOHy7gdkGLge8ghBEQHMWmyJFoXlpU58kIrhhN3w26lpQb6dspetweapMn2CSNwQ8I4wg==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/wasi-threads": "1.1.0",
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@emnapi/runtime": {
      "version": "1.7.1",
      "resolved": "https://registry.npmjs.org/@emnapi/runtime/-/runtime-1.7.1.tgz",
      "integrity": "sha512-PVtJr5CmLwYAU9PZDMITZoR5iAOShYREoR45EyyLrbntV50mdePTgUn4AmOw90Ifcj+x2kRjdzr1HP3RrNiHGA==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@emnapi/wasi-threads": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@emnapi/wasi-threads/-/wasi-threads-1.1.0.tgz",
      "integrity": "sha512-WI0DdZ8xFSbgMjR1sFsKABJ/C5OnRrjT06JXbZKexJGrDuPTzZdDYfFlsgcCXCyf+suG5QU2e/y1Wo2V/OapLQ==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@esbuild/aix-ppc64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.23.1.tgz",
      "integrity": "sha512-6VhYk1diRqrhBAqpJEdjASR/+WVRtfjpqKuNw11cLiaWpAT/Uu+nokB+UJnevzy/P9C/ty6AOe0dwueMrGh/iQ==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "aix"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/android-arm64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm64/-/android-arm64-0.23.1.tgz",
      "integrity": "sha512-xw50ipykXcLstLeWH7WRdQuysJqejuAGPd30vd1i5zSyKK3WE+ijzHmLKxdiCMtH1pHz78rOg0BKSYOSB/2Khw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/android-x64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/android-x64/-/android-x64-0.23.1.tgz",
      "integrity": "sha512-nlN9B69St9BwUoB+jkyU090bru8L0NA3yFvAd7k8dNsVH8bi9a8cUAUSEcEEgTp2z3dbEDGJGfP6VUnkQnlReg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/darwin-arm64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-arm64/-/darwin-arm64-0.23.1.tgz",
      "integrity": "sha512-YsS2e3Wtgnw7Wq53XXBLcV6JhRsEq8hkfg91ESVadIrzr9wO6jJDMZnCQbHm1Guc5t/CdDiFSSfWP58FNuvT3Q==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/darwin-x64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-x64/-/darwin-x64-0.23.1.tgz",
      "integrity": "sha512-aClqdgTDVPSEGgoCS8QDG37Gu8yc9lTHNAQlsztQ6ENetKEO//b8y31MMu2ZaPbn4kVsIABzVLXYLhCGekGDqw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/freebsd-arm64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-arm64/-/freebsd-arm64-0.23.1.tgz",
      "integrity": "sha512-h1k6yS8/pN/NHlMl5+v4XPfikhJulk4G+tKGFIOwURBSFzE8bixw1ebjluLOjfwtLqY0kewfjLSrO6tN2MgIhA==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/freebsd-x64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-x64/-/freebsd-x64-0.23.1.tgz",
      "integrity": "sha512-lK1eJeyk1ZX8UklqFd/3A60UuZ/6UVfGT2LuGo3Wp4/z7eRTRYY+0xOu2kpClP+vMTi9wKOfXi2vjUpO1Ro76g==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-arm": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm/-/linux-arm-0.23.1.tgz",
      "integrity": "sha512-CXXkzgn+dXAPs3WBwE+Kvnrf4WECwBdfjfeYHpMeVxWE0EceB6vhWGShs6wi0IYEqMSIzdOF1XjQ/Mkm5d7ZdQ==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-arm64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm64/-/linux-arm64-0.23.1.tgz",
      "integrity": "sha512-/93bf2yxencYDnItMYV/v116zff6UyTjo4EtEQjUBeGiVpMmffDNUyD9UN2zV+V3LRV3/on4xdZ26NKzn6754g==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-ia32": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ia32/-/linux-ia32-0.23.1.tgz",
      "integrity": "sha512-VTN4EuOHwXEkXzX5nTvVY4s7E/Krz7COC8xkftbbKRYAl96vPiUssGkeMELQMOnLOJ8k3BY1+ZY52tttZnHcXQ==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-mips64el": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-mips64el/-/linux-mips64el-0.23.1.tgz",
      "integrity": "sha512-nrFzzMQ7W4WRLNUOU5dlWAqa6yVeI0P78WKGUo7lg2HShq/yx+UYkeNSE0SSfSure0SqgnsxPvmAUu/vu0E+3Q==",
      "cpu": [
        "mips64el"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-ppc64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ppc64/-/linux-ppc64-0.23.1.tgz",
      "integrity": "sha512-dKN8fgVqd0vUIjxuJI6P/9SSSe/mB9rvA98CSH2sJnlZ/OCZWO1DJvxj8jvKTfYUdGfcq2dDxoKaC6bHuTlgcw==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-riscv64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-riscv64/-/linux-riscv64-0.23.1.tgz",
      "integrity": "sha512-5AV4Pzp80fhHL83JM6LoA6pTQVWgB1HovMBsLQ9OZWLDqVY8MVobBXNSmAJi//Csh6tcY7e7Lny2Hg1tElMjIA==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-s390x": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-s390x/-/linux-s390x-0.23.1.tgz",
      "integrity": "sha512-9ygs73tuFCe6f6m/Tb+9LtYxWR4c9yg7zjt2cYkjDbDpV/xVn+68cQxMXCjUpYwEkze2RcU/rMnfIXNRFmSoDw==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-x64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-x64/-/linux-x64-0.23.1.tgz",
      "integrity": "sha512-EV6+ovTsEXCPAp58g2dD68LxoP/wK5pRvgy0J/HxPGB009omFPv3Yet0HiaqvrIrgPTBuC6wCH1LTOY91EO5hQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/netbsd-x64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/netbsd-x64/-/netbsd-x64-0.23.1.tgz",
      "integrity": "sha512-aevEkCNu7KlPRpYLjwmdcuNz6bDFiE7Z8XC4CPqExjTvrHugh28QzUXVOZtiYghciKUacNktqxdpymplil1beA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "netbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/openbsd-arm64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-arm64/-/openbsd-arm64-0.23.1.tgz",
      "integrity": "sha512-3x37szhLexNA4bXhLrCC/LImN/YtWis6WXr1VESlfVtVeoFJBRINPJ3f0a/6LV8zpikqoUg4hyXw0sFBt5Cr+Q==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/openbsd-x64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-x64/-/openbsd-x64-0.23.1.tgz",
      "integrity": "sha512-aY2gMmKmPhxfU+0EdnN+XNtGbjfQgwZj43k8G3fyrDM/UdZww6xrWxmDkuz2eCZchqVeABjV5BpildOrUbBTqA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/sunos-x64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/sunos-x64/-/sunos-x64-0.23.1.tgz",
      "integrity": "sha512-RBRT2gqEl0IKQABT4XTj78tpk9v7ehp+mazn2HbUeZl1YMdaGAQqhapjGTCe7uw7y0frDi4gS0uHzhvpFuI1sA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "sunos"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/win32-arm64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-arm64/-/win32-arm64-0.23.1.tgz",
      "integrity": "sha512-4O+gPR5rEBe2FpKOVyiJ7wNDPA8nGzDuJ6gN4okSA1gEOYZ67N8JPk58tkWtdtPeLz7lBnY6I5L3jdsr3S+A6A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/win32-ia32": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-ia32/-/win32-ia32-0.23.1.tgz",
      "integrity": "sha512-BcaL0Vn6QwCwre3Y717nVHZbAa4UBEigzFm6VdsVdT/MbZ38xoj1X9HPkZhbmaBGUD1W8vxAfffbDe8bA6AKnQ==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/win32-x64": {
      "version": "0.23.1",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-x64/-/win32-x64-0.23.1.tgz",
      "integrity": "sha512-BHpFFeslkWrXWyUPnbKm+xYYVYruCinGcftSBaa8zoF9hZO4BcSCFUvHVTtzpIY6YzUnYtuEhZ+C9iEXjxnasg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@eslint-community/eslint-utils": {
      "version": "4.9.0",
      "resolved": "https://registry.npmjs.org/@eslint-community/eslint-utils/-/eslint-utils-4.9.0.tgz",
      "integrity": "sha512-ayVFHdtZ+hsq1t2Dy24wCmGXGe4q9Gu3smhLYALJrr473ZH27MsnSL+LKUlimp4BWJqMDMLmPpx/Q9R3OAlL4g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "eslint-visitor-keys": "^3.4.3"
      },
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      },
      "peerDependencies": {
        "eslint": "^6.0.0 || ^7.0.0 || >=8.0.0"
      }
    },
    "node_modules/@eslint-community/eslint-utils/node_modules/eslint-visitor-keys": {
      "version": "3.4.3",
      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-3.4.3.tgz",
      "integrity": "sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/@eslint-community/regexpp": {
      "version": "4.12.2",
      "resolved": "https://registry.npmjs.org/@eslint-community/regexpp/-/regexpp-4.12.2.tgz",
      "integrity": "sha512-EriSTlt5OC9/7SXkRSCAhfSxxoSUgBm33OH+IkwbdpgoqsSsUg7y3uh+IICI/Qg4BBWr3U2i39RpmycbxMq4ew==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^12.0.0 || ^14.0.0 || >=16.0.0"
      }
    },
    "node_modules/@eslint/config-array": {
      "version": "0.21.1",
      "resolved": "https://registry.npmjs.org/@eslint/config-array/-/config-array-0.21.1.tgz",
      "integrity": "sha512-aw1gNayWpdI/jSYVgzN5pL0cfzU02GT3NBpeT/DXbx1/1x7ZKxFPd9bwrzygx/qiwIQiJ1sw/zD8qY/kRvlGHA==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/object-schema": "^2.1.7",
        "debug": "^4.3.1",
        "minimatch": "^3.1.2"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/config-helpers": {
      "version": "0.4.2",
      "resolved": "https://registry.npmjs.org/@eslint/config-helpers/-/config-helpers-0.4.2.tgz",
      "integrity": "sha512-gBrxN88gOIf3R7ja5K9slwNayVcZgK6SOUORm2uBzTeIEfeVaIhOpCtTox3P6R7o2jLFwLFTLnC7kU/RGcYEgw==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/core": "^0.17.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/core": {
      "version": "0.17.0",
      "resolved": "https://registry.npmjs.org/@eslint/core/-/core-0.17.0.tgz",
      "integrity": "sha512-yL/sLrpmtDaFEiUj1osRP4TI2MDz1AddJL+jZ7KSqvBuliN4xqYY54IfdN8qD8Toa6g1iloph1fxQNkjOxrrpQ==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@types/json-schema": "^7.0.15"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/eslintrc": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/@eslint/eslintrc/-/eslintrc-3.3.1.tgz",
      "integrity": "sha512-gtF186CXhIl1p4pJNGZw8Yc6RlshoePRvE0X91oPGb3vZ8pM3qOS9W9NGPat9LziaBV7XrJWGylNQXkGcnM3IQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ajv": "^6.12.4",
        "debug": "^4.3.2",
        "espree": "^10.0.1",
        "globals": "^14.0.0",
        "ignore": "^5.2.0",
        "import-fresh": "^3.2.1",
        "js-yaml": "^4.1.0",
        "minimatch": "^3.1.2",
        "strip-json-comments": "^3.1.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/@eslint/js": {
      "version": "9.39.1",
```

├─ package.json
```json
{
  "name": "agw-app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-slot": "^1.2.4",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "lucide-react": "^0.554.0",
    "next": "16.0.3",
    "next-pwa": "^5.6.0",
    "next-themes": "^0.4.6",
    "react": "19.2.0",
    "react-dom": "19.2.0",
    "sonner": "^2.0.7",
    "tailwind-merge": "^3.4.0"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.22",
    "eslint": "^9",
    "eslint-config-next": "16.0.3",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.18",
    "tw-animate-css": "^1.4.0",
    "typescript": "^5"
  }
}
```

├─ postcss.config.js
```javascript
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

├─ proxy.ts
```typescript
import { NextResponse, NextRequest } from "next/server";

export function proxy(request: NextRequest) {
  const url = request.nextUrl;
  const userSession = request.cookies.get("agw_session")?.value;
  const adminSession = request.cookies.get("agw_admin_session")?.value;

  // Protect /dashboard/*
  if (url.pathname.startsWith("/dashboard")) {
    if (!userSession) {
      const redirect = url.clone();
      redirect.pathname = "/login";
      return NextResponse.redirect(redirect);
    }
  }

  // Protect /admin/*
  if (url.pathname.startsWith("/admin")) {
    // Allow /admin/login
    if (url.pathname.startsWith("/admin/login")) {
      return NextResponse.next();
    }

    if (!adminSession) {
      const redirect = url.clone();
      redirect.pathname = "/admin/login";
      return NextResponse.redirect(redirect);
    }
  }

  return NextResponse.next();
}

export const config = {
  matcher: [
    "/dashboard/:path*",
    "/admin/:path*"
  ],
};
```

├─ public/manifest.json
```json
{
    "name": "AGW - A Gold Winner",
    "short_name": "AGW",
    "start_url": "/",
    "display": "standalone",
    "background_color": "#000000",
    "theme_color": "#FFD700",
    "description": "AGW platform reward-based gamified system",
    "icons": [
      {
        "src": "/icons/icon-192.png",
        "sizes": "192x192",
        "type": "image/png"
      },
      {
        "src": "/icons/icon-512.png",
        "sizes": "512x512",
        "type": "image/png"
      }
    ]
  }
  ```

├─ public/sw.js
```javascript
self.addEventListener("install", (event) => {
    event.waitUntil(
      caches.open("agw-cache").then((cache) => {
        return cache.addAll(["/"]);
      })
    );
  });
  
  self.addEventListener("fetch", (event) => {
    event.respondWith(
      caches.match(event.request).then((resp) => {
        return resp || fetch(event.request);
      })
    );
  });
  ```

├─ tailwind.config.js
```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
```

├─ tsconfig.json
```json
{
  "compilerOptions": {
    
    "target": "ES2017",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "baseUrl": ".",
    "paths": {
      "@/components/*": [
        "components/*"
      ],
      "@/lib/*": [
        "lib/*"
      ],
      "@/app/*": [
        "app/*"
      ]
    },
    "typeRoots": [
      "./types",
      "./node_modules/@types"
    ],
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
```

├─ types/css.d.ts
```typescript
declare module "*.css";```

├─ workers/api.js
```javascript
import { cors } from "./core/cors.js";
import { json } from "./core/json.js";
import { userRoutes } from "./routes/user.js";
import { adminRoutes } from "./routes/admin.js";

export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    const method = request.method;

    // Handle OPTIONS
    if (method === "OPTIONS") {
      return new Response(null, { status: 204, headers: cors() });
    }

    // USER ROUTES
    const u = await userRoutes(url, method, request, env);
    if (u) return u;

    // ADMIN ROUTES
    const a = await adminRoutes(url, method, request, env);
    if (a) return a;

    return json({ ok: false, error: "NOT_FOUND" }, 404);
  },
};
```

├─ workers/core/cors.js
```javascript
export function cors(type = "application/json") {
    return {
      "Content-Type": type,
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "GET,POST,OPTIONS",
      "Access-Control-Allow-Headers": "Content-Type, x-admin-token"
    };
  }
  ```

├─ workers/core/json.js
```javascript
import { cors } from "./cors.js";

export function json(data, status = 200) {
  return new Response(JSON.stringify(data), {
    status,
    headers: cors("application/json"),
  });
}
```

├─ workers/routes/admin.js
```javascript
import { json } from "../core/json.js";
import { getAdmin } from "../services/admin.js";
import { hashPassword, verifyPassword } from "../utils/password.js";
import { getUser, saveUser } from "../services/user.js";
import { createSession, verifySession } from "../services/session.js";

export async function adminRoutes(url, method, request, env) {

  // ADMIN LOGIN
  if (url.pathname === "/api/admin/login" && method === "POST") {
    const { email, password } = await request.json();
    const admin = await getAdmin(env, email);
    if (!admin) return json({ ok: false, error: "ADMIN_NOT_FOUND" }, 404);

    const ok = await verifyPassword(password, admin.password_hash, admin.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_PASSWORD" }, 401);

    const session = await createSession(env, admin.id, "admin");
    return json({ ok: true, sessionId: session.sessionId });
  }

  // ADMIN ME
  if (url.pathname === "/api/admin/me" && method === "POST") {
    const { sessionId } = await request.json();
    const session = await verifySession(env, sessionId);
    return json({ ok: !!session });
  }

  // OVERVIEW
  if (url.pathname === "/api/admin/overview" && method === "POST") {
    const { sessionId } = await request.json();
    const session = await verifySession(env, sessionId);
    if (!session) return json({ ok: false, error: "UNAUTHORIZED" }, 403);

    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });

    let totalUsers = 0;
    let activeSubs = 0;

    for (const k of keys) {
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;

      try {
        const user = JSON.parse(raw);
        if (user.id) totalUsers++;
        if (user.subscription?.type) activeSubs++;
      } catch {}
    }

    return json({ ok: true, totalUsers, activeSubs });
  }

  // USERS LIST
  if (url.pathname === "/api/admin/users/list" && method === "GET") {
    const sessionId = url.searchParams.get("sessionId");
    const session = await verifySession(env, sessionId);
    if (!session) return json({ ok: false, error: "UNAUTHORIZED" }, 403);

    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
    const users = [];

    for (const k of keys) {
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;

      try {
        const user = JSON.parse(raw);
        users.push(user);
      } catch {}
    }

    return json({ ok: true, users });
  }

  // USER UPDATE
  if (url.pathname === "/api/admin/user/update" && method === "POST") {
    const { sessionId, id, field, value } = await request.json();
    const session = await verifySession(env, sessionId);
    if (!session) return json({ ok: false, error: "UNAUTHORIZED" }, 403);

    const user = await getUser(env, id);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);

    if (field === "delete") {
      await env.AGW_USERS.delete(`user:${id}`);
      return json({ ok: true, deleted: true });
    }

    user[field] = value;
    await saveUser(env, id, user);
    return json({ ok: true, user });
  }

  // USER SAVE (ADMIN)
  if (url.pathname === "/api/admin/user/save" && method === "POST") {
    const { sessionId, user } = await request.json();
    const session = await verifySession(env, sessionId);
    if (!session || session.role !== "admin") {
      return json({ ok: false, error: "UNAUTHORIZED" }, 403);
    }

    await saveUser(env, user.id, user);
    return json({ ok: true });
  }
  // ADMIN BOOTSTRAP (crea superadmin una sola volta)
if (url.pathname === "/api/admin/bootstrap" && method === "POST") {
  const { token, email, password } = await request.json();

  // protezione semplice
  if (token !== env.ADMIN_TOKEN) {
    return json({ ok: false, error: "FORBIDDEN" }, 403);
  }

  const existing = await getAdmin(env, email);
  if (existing) {
    return json({ ok: false, error: "ADMIN_ALREADY_EXISTS" }, 409);
  }

  const { hash, salt } = await hashPassword(password);

  const admin = {
    id: crypto.randomUUID(),
    email,
    password_hash: hash,
    password_salt: salt,
    role: "admin",
    createdAt: Date.now()
  };

  await env.AGW_ADMIN.put(`admin:${admin.id}`, JSON.stringify(admin));

  return json({ ok: true, admin });
}
  return null;
}
```

├─ workers/routes/user.js
```javascript
import { json } from "../core/json.js";
import { getUser, saveUser, findUserByEmail } from "../services/user.js";
import { createSession, verifySession, deleteSession } from "../services/session.js";
import { hashPassword, verifyPassword } from "../utils/password.js";

export async function userRoutes(url, method, request, env) {

  // LOGIN
  if (url.pathname === "/api/user/login" && method === "POST") {
    const { email, password } = await request.json();
    const user = await findUserByEmail(env, email);
    if (!user) return json({ ok: false, error: "EMAIL_NOT_FOUND" }, 404);

    const ok = await verifyPassword(password, user.password_hash, user.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_PASSWORD" }, 401);

    const session = await createSession(env, user.id, "user");
    return json({ ok: true, sessionId: session.sessionId });
  }

  // REGISTER
  if (url.pathname.replace(/\/+$/, "") === "/api/user/register" && method === "POST")
    {
    const { email, password, firstname, lastname } = await request.json();

    const exists = await findUserByEmail(env, email);
    if (exists) return json({ ok: false, error: "EMAIL_EXISTS" }, 409);

    const id = crypto.randomUUID();
    const { hash, salt } = await hashPassword(password);

    const user = {
      id,
      email,
      firstname,
      lastname,
      mailing: { primary: email },
      password_hash: hash,
      password_salt: salt,
      status: { suspended: false, createdAt: Date.now() },
      stats: {},
    };

    await saveUser(env, id, user);
    return json({ ok: true });
  }

  // GET USER
  if (url.pathname === "/api/user/get" && method === "POST") {
    const { userId } = await request.json();
    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);
    return json({ ok: true, user });
  }

  // UPDATE PROFILE
  if (url.pathname === "/api/user/update-profile" && method === "POST") {
    const { userId, data } = await request.json();

    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);

    Object.assign(user, data);
    await saveUser(env, userId, user);
    return json({ ok: true, user });
  }

  // UPDATE PASSWORD
  if (url.pathname === "/api/user/update-password" && method === "POST") {
    const { userId, oldPassword, newPassword } = await request.json();

    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);

    const ok = await verifyPassword(oldPassword, user.password_hash, user.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_OLD_PASSWORD" }, 403);

    const { hash, salt } = await hashPassword(newPassword);
    user.password_hash = hash;
    user.password_salt = salt;

    await saveUser(env, userId, user);
    return json({ ok: true });
  }

  // DELETE ACCOUNT
  if (url.pathname === "/api/user/delete-account" && method === "POST") {
    const { userId } = await request.json();
    await env.AGW_USERS.delete(`user:${userId}`);
    return json({ ok: true });
  }

  // UPDATE EMAIL PREFS
  if (url.pathname === "/api/user/update-email-prefs" && method === "POST") {
    const { userId, prefs } = await request.json();

    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);

    user.mailing = user.mailing || {};
    user.mailing.preferences = { ...(user.mailing.preferences || {}), ...prefs };

    await saveUser(env, userId, user);
    return json({ ok: true, user });
  }

  // UPDATE AVATAR
  if (url.pathname === "/api/user/update-avatar" && method === "POST") {
    const { userId, avatarBase64 } = await request.json();

    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" }, 404);

    user.profile_image = avatarBase64;

    await saveUser(env, userId, user);
    return json({ ok: true, user });
  }

  // REQUEST PASSWORD RESET
  if (url.pathname === "/api/user/request-reset" && method === "POST") {
    const { email } = await request.json();

    const user = await findUserByEmail(env, email);
    if (!user) return json({ ok: true }); // non rivelare

    const token = crypto.randomUUID();
    user.resetToken = token;
    user.resetTokenExp = Date.now() + 1000 * 60 * 10; // 10 min

    await saveUser(env, user.id, user);
    return json({ ok: true, token });
  }

  // DO RESET
  if (url.pathname === "/api/user/do-reset" && method === "POST") {
    const { token, newPassword } = await request.json();

    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });

    for (const k of keys) {
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;

      const user = JSON.parse(raw);

      if (user.resetToken === token && Date.now() < user.resetTokenExp) {
        const { hash, salt } = await hashPassword(newPassword);
        user.password_hash = hash;
        user.password_salt = salt;

        delete user.resetToken;
        delete user.resetTokenExp;

        await saveUser(env, user.id, user);
        return json({ ok: true });
      }
    }

    return json({ ok: false, error: "INVALID_OR_EXPIRED_TOKEN" }, 400);
  }

  // LOGOUT
  if (url.pathname === "/api/user/logout" && method === "POST") {
    const { sessionId } = await request.json();
    await deleteSession(env, sessionId);
    return json({ ok: true });
  }

  // CHANGE PASSWORD
  if (url.pathname === "/api/user/change-password" && method === "POST") {
    const { userId, oldPassword, newPassword } = await request.json();

    const user = await getUser(env, userId);
    if (!user) return json({ ok: false, error: "USER_NOT_FOUND" });

    const ok = await verifyPassword(oldPassword, user.password_hash, user.password_salt);
    if (!ok) return json({ ok: false, error: "WRONG_OLD_PASSWORD" }, 403);

    const { hash, salt } = await hashPassword(newPassword);
    user.password_hash = hash;
    user.password_salt = salt;

    await saveUser(env, userId, user);
    return json({ ok: true });
  }

  return null;
}
```

├─ workers/services/admin.js
```javascript
import { hashPassword, verifyPassword } from "../utils/password.js";

/**
 * Normalizza l'email per ricerca e matching
 */
function normalize(value) {
  return (value || "").trim().toLowerCase();
}

/**
 * Recupera un admin tramite email
 * (BFF usa solo email + password)
 */
export async function getAdmin(env, email) {
  const target = normalize(email);

  const { keys } = await env.AGW_ADMIN.list({ prefix: "admin:" });

  for (const k of keys) {
    if (!k.name.startsWith("admin:")) continue;

    const raw = await env.AGW_ADMIN.get(k.name);
    if (!raw) continue;

    let admin;
    try {
      admin = JSON.parse(raw);
    } catch {
      continue;
    }

    if (normalize(admin.email) === target) {
      return admin;
    }
  }

  return null;
}

/**
 * Salva/aggiorna un admin in KV
 */
export async function saveAdmin(env, id, admin) {
  await env.AGW_ADMIN.put(`admin:${id}`, JSON.stringify(admin));
}

/**
 * Crea un nuovo admin
 * (serve in onboarding del sistema)
 */
export async function createAdmin(env, email, password) {
  const id = crypto.randomUUID();
  const normEmail = normalize(email);

  const { hash, salt } = await hashPassword(password);

  const admin = {
    id,
    email: normEmail,
    password_hash: hash,
    password_salt: salt,
    role: "admin",
    createdAt: Date.now(),
    updatedAt: Date.now(),
  };

  await saveAdmin(env, id, admin);

  return admin;
}

/**
 * Verifica login admin → ritorna admin se password corretta
 */
export async function authenticateAdmin(env, email, password) {
  const admin = await getAdmin(env, email);
  if (!admin) return null;

  const ok = await verifyPassword(password, admin.password_hash, admin.password_salt);
  if (!ok) return null;

  return admin;
}
```

├─ workers/services/session.js
```javascript
// Unified session system

export async function createSession(env, userId, role = "user") {
    const sessionId = crypto.randomUUID();
    const session = {
      sessionId,
      userId,
      role,
      createdAt: Date.now(),
      expiresAt: Date.now() + 1000 * 60 * 60 * 24 * 30, // 30 days
    };
  
    await env.AGW_SESSIONS.put(`sess:${sessionId}`, JSON.stringify(session));
    return session;
  }
  
  export async function verifySession(env, sessionId) {
    if (!sessionId) return null;
    const raw = await env.AGW_SESSIONS.get(`sess:${sessionId}`);
    if (!raw) return null;
  
    const session = JSON.parse(raw);
  
    if (session.expiresAt < Date.now()) {
      await env.AGW_SESSIONS.delete(`sess:${sessionId}`);
      return null;
    }
  
    return session;
  }
  
  export async function deleteSession(env, sessionId) {
    await env.AGW_SESSIONS.delete(`sess:${sessionId}`);
  }
  ```

├─ workers/services/user.js
```javascript
export async function saveUser(env, id, user) {
    await env.AGW_USERS.put(`user:${id}`, JSON.stringify(user));
  }
  
  export async function getUser(env, id) {
    const raw = await env.AGW_USERS.get(`user:${id}`);
    return raw ? JSON.parse(raw) : null;
  }
  
  export async function findUserByEmail(env, email) {
    const norm = (v) => (v || "").trim().toLowerCase();
    const target = norm(email);
    if (!target) return null;
  
    const { keys } = await env.AGW_USERS.list({ prefix: "user:" });
  
    for (const k of keys) {
      if (k.name === "user:index") continue;
      const raw = await env.AGW_USERS.get(k.name);
      if (!raw) continue;
  
      let user;
      try {
        user = JSON.parse(raw);
      } catch {
        continue;
      }
  
      if (norm(user.email) === target || norm(user.mailing?.primary) === target) {
        return user;
      }
    }
  
    return null;
  }
  ```

├─ workers/utils/password.js
```javascript
// PBKDF2 password hashing compatible with Cloudflare Workers

export async function hashPassword(password) {
  const encoder = new TextEncoder();
  const salt = crypto.getRandomValues(new Uint8Array(16));

  const keyMaterial = await crypto.subtle.importKey(
      "raw",
      encoder.encode(password),
      { name: "PBKDF2" },
      false,
      ["deriveBits", "deriveKey"]
  );

  const key = await crypto.subtle.deriveKey(
      {
          name: "PBKDF2",
          salt,
          iterations: 100000,      // Cloudflare MAX
          hash: "SHA-256",
      },
      keyMaterial,
      { name: "AES-GCM", length: 256 },
      true,
      ["encrypt", "decrypt"]
  );

  const rawKey = new Uint8Array(await crypto.subtle.exportKey("raw", key));

  return {
      hash: btoa(String.fromCharCode(...rawKey)),
      salt: btoa(String.fromCharCode(...salt)),
  };
}

export async function verifyPassword(password, hash, salt) {
  const encoder = new TextEncoder();
  const saltBytes = Uint8Array.from(atob(salt), c => c.charCodeAt(0));
  const hashBytes = Uint8Array.from(atob(hash), c => c.charCodeAt(0));

  const keyMaterial = await crypto.subtle.importKey(
      "raw",
      encoder.encode(password),
      { name: "PBKDF2" },
      false,
      ["deriveBits", "deriveKey"]
  );

  const key = await crypto.subtle.deriveKey(
      {
          name: "PBKDF2",
          salt: saltBytes,
          iterations: 100000,      // Cloudflare MAX
          hash: "SHA-256",
      },
      keyMaterial,
      { name: "AES-GCM", length: 256 },
      true,
      ["encrypt", "decrypt"]
  );

  const rawKey = new Uint8Array(await crypto.subtle.exportKey("raw", key));

  return rawKey.every((b, i) => b === hashBytes[i]);
}
```

francescomaggi@MacBook-Pro agw-app % 