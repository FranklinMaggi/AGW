(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51364,e=>{"use strict";var n=e.i(43476),s=e.i(71645),t=e.i(18566);function i(e){if(!e||Number.isNaN(e))return"—";try{return new Date(e).toLocaleDateString("it-IT")}catch{return"—"}}function r({users:e,token:t}){let[r,c]=(0,s.useState)(""),[x,m]=(0,s.useState)([]);if(!t)return(0,n.jsxs)("div",{className:"admin-card p-6 text-red-500 font-bold",children:["ERRORE: Token amministratore mancante.",(0,n.jsx)("br",{}),"Accedi tramite /admin/login oppure apri:",(0,n.jsx)("br",{}),"/admin/users?token=IL_TUO_TOKEN"]});function u(e){return e?String(e).toLowerCase():""}let j=(Array.isArray(e)?e:[]).filter(e=>{let n=r.toLowerCase();return u(e.id).includes(n)||u(e.nickname).includes(n)||u(e.firstname).includes(n)||u(e.lastname).includes(n)||u(e.email).includes(n)||u(e.subscription?.type).includes(n)||u(e.bonus?.award).includes(n)});async function p(){if(confirm(`Eliminare definitivamente ${x.length} utenti?`)){for(let e of x)await fetch("https://agw.franklin19.workers.dev/api/admin/user/update",{method:"POST",headers:{"Content-Type":"application/json","x-admin-token":t},body:JSON.stringify({token:t,id:e,field:"delete"})});alert("Utenti eliminati correttamente."),window.location.reload()}}return(0,n.jsxs)("div",{className:"admin-card p-4 space-y-4 overflow-auto",children:[(0,n.jsx)("input",{className:"admin-input",placeholder:"Search user (id, name, email, subscription...)",value:r,onChange:e=>c(e.target.value)}),x.length>0&&(0,n.jsxs)("button",{onClick:p,className:"admin-btn admin-btn-danger",children:["Delete Selected (",x.length,")"]}),(0,n.jsx)("div",{className:"overflow-auto",children:(0,n.jsxs)("table",{className:"min-w-full text-sm text-left border-collapse",children:[(0,n.jsx)("thead",{className:"bg-[var(--admin-surface-light)]",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)(a,{children:(0,n.jsx)("input",{type:"checkbox",checked:x.length===j.length&&j.length>0,onChange:function(){x.length===j.length?m([]):m(j.map(e=>e.id))}})}),(0,n.jsx)(a,{children:"Avatar"}),(0,n.jsx)(a,{children:"Edit"}),(0,n.jsx)(a,{children:"Delete"}),(0,n.jsx)(a,{children:"ID"}),(0,n.jsx)(a,{children:"Nickname"}),(0,n.jsx)(a,{children:"Name"}),(0,n.jsx)(a,{children:"Email"}),(0,n.jsx)(a,{children:"Birth"}),(0,n.jsx)(a,{children:"Gender"}),(0,n.jsx)(a,{children:"Height"}),(0,n.jsx)(a,{children:"Weight"}),(0,n.jsx)(a,{children:"Job"}),(0,n.jsx)(a,{children:"Status"}),(0,n.jsx)(a,{children:"Created"}),(0,n.jsx)(a,{children:"Level"}),(0,n.jsx)(a,{children:"Level Y"}),(0,n.jsx)(a,{children:"Rank M"}),(0,n.jsx)(a,{children:"Mot W"}),(0,n.jsx)(a,{children:"Ass D"}),(0,n.jsx)(a,{children:"KRM Tot"}),(0,n.jsx)(a,{children:"KRM Y"}),(0,n.jsx)(a,{children:"KRM M"}),(0,n.jsx)(a,{children:"KRM W"}),(0,n.jsx)(a,{children:"KRM D"}),(0,n.jsx)(a,{children:"Subscription"}),(0,n.jsx)(a,{children:"Pay Status"}),(0,n.jsx)(a,{children:"Payment Date"}),(0,n.jsx)(a,{children:"Expires"}),(0,n.jsx)(a,{children:"Bonus"}),(0,n.jsx)(a,{children:"Bonus Exp"}),(0,n.jsx)(a,{children:"Daily"}),(0,n.jsx)(a,{children:"Weekly"}),(0,n.jsx)(a,{children:"Missions Tot"}),(0,n.jsx)(a,{children:"Missions M"}),(0,n.jsx)(a,{children:"Missions W"}),(0,n.jsx)(a,{children:"Missions T"}),(0,n.jsx)(a,{children:"Last MS"})]})}),(0,n.jsx)("tbody",{children:j.map(e=>(0,n.jsxs)("tr",{className:"border-b border-[var(--admin-border)]",children:[(0,n.jsx)(l,{children:(0,n.jsx)("input",{type:"checkbox",checked:x.includes(e.id),onChange:()=>{var n;return n=e.id,void m(e=>e.includes(n)?e.filter(e=>e!==n):[...e,n])}})}),(0,n.jsx)(l,{children:(0,n.jsx)(d,{user:e})}),(0,n.jsx)(l,{children:(0,n.jsx)("a",{href:`/admin/users/${e.id}/edit?token=${t}`,className:"admin-btn admin-btn-blue text-xs",children:"Edit"})}),(0,n.jsx)(l,{children:(0,n.jsx)("button",{onClick:async()=>{if(!confirm(`Eliminare definitivamente l'utente ${e.nickname}?`))return;let n=await fetch("https://agw.franklin19.workers.dev/api/admin/user/update",{method:"POST",headers:{"Content-Type":"application/json","x-admin-token":t},body:JSON.stringify({token:t,id:e.id,field:"delete"})}),s=await n.json();s.deleted?(alert("Utente eliminato."),window.location.reload()):alert("Errore eliminazione: "+(s.error??""))},className:"admin-btn admin-btn-danger text-xs",children:"Delete"})}),(0,n.jsx)(l,{children:e.id}),(0,n.jsx)(l,{children:e.nickname}),(0,n.jsxs)(l,{children:[e.firstname," ",e.lastname]}),(0,n.jsx)(l,{children:e.mailing?.primary}),(0,n.jsx)(l,{children:e.personal?.birthdate}),(0,n.jsx)(l,{children:e.personal?.gender}),(0,n.jsx)(l,{children:e.personal?.height}),(0,n.jsx)(l,{children:e.personal?.weight}),(0,n.jsx)(l,{children:e.personal?.job}),(0,n.jsx)(l,{children:e.status?.suspended?"Suspended":"Active"}),(0,n.jsx)(l,{children:new Date(e.status?.createdAt).toLocaleDateString()}),(0,n.jsx)(l,{children:e.stats?.level_total}),(0,n.jsx)(l,{children:e.stats?.level_year}),(0,n.jsx)(l,{children:e.stats?.rank_month}),(0,n.jsx)(l,{children:e.stats?.motivation_week}),(0,n.jsx)(l,{children:e.stats?.assessment_day}),(0,n.jsx)(l,{children:e.stats?.krm_total}),(0,n.jsx)(l,{children:e.stats?.krm_year}),(0,n.jsx)(l,{children:e.stats?.krm_month}),(0,n.jsx)(l,{children:e.stats?.krm_week}),(0,n.jsx)(l,{children:e.stats?.krm_day}),(0,n.jsx)(l,{children:e.subscription?.type}),(0,n.jsx)(l,{children:(0,n.jsx)(o,{status:e.subscription?.payment_status})}),(0,n.jsx)(l,{children:i(e.subscription?.last_payment_at)}),(0,n.jsx)(l,{children:i(e.subscription?.expires_at)}),(0,n.jsx)(l,{children:e.bonus?.award}),(0,n.jsx)(l,{children:i(e.bonus?.expiresAt)}),(0,n.jsxs)(l,{children:[e.discipline?.daily_completed,"/",e.discipline?.daily_goal]}),(0,n.jsxs)(l,{children:[e.discipline?.weekly_completed,"/",e.discipline?.weekly_goal]}),(0,n.jsx)(l,{children:e.stats?.missions_completed_total}),(0,n.jsx)(l,{children:e.stats?.missions_completed_month}),(0,n.jsx)(l,{children:e.stats?.missions_completed_week}),(0,n.jsx)(l,{children:e.stats?.missions_completed_today}),(0,n.jsx)(l,{children:(0,n.jsx)(h,{missions:e.missions})})]},String(e.id||e.index)))})]})})]})}function a({children:e}){return(0,n.jsx)("th",{className:"px-3 py-2 font-semibold text-[var(--admin-gold)] whitespace-nowrap",children:e})}function l({children:e}){return(0,n.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:e})}function d({user:e}){let s=e.profile_image||e.avatar_ai||"/default-avatar.png";return(0,n.jsx)("img",{src:s,className:"w-10 h-10 rounded-full object-cover border border-[var(--admin-border)]"})}let c=["green","orange","red"];function o({status:e}){let s=c.includes(e)?({green:"text-green-400",orange:"text-orange-400",red:"text-red-400"})[e]:"text-neutral-400";return(0,n.jsx)("span",{className:s,children:e})}function h({missions:e}){if(!e||0===e.length)return(0,n.jsx)("span",{className:"text-neutral-400",children:"—"});let s=e[e.length-1].status;return(0,n.jsx)("span",{className:{approved:"text-green-400",pending:"text-orange-400",rejected:"text-red-400"}[s]??"text-neutral-400",children:s})}function x(){let e=(0,t.useSearchParams)().get("token"),[i,a]=(0,s.useState)([]),[l,d]=(0,s.useState)(""),[c,o]=(0,s.useState)(""),[h,x]=(0,s.useState)(null),[m,u]=(0,s.useState)(!1),[j,p]=(0,s.useState)("");async function f(){let n=await fetch("https://agw.franklin19.workers.dev/api/admin/users/list",{headers:{"x-admin-token":e??""}}),s=await n.json();s.error||a(s.users)}async function g(){if(!c)return;u(!0),p("");let e=await fetch("https://agw.franklin19.workers.dev/api/user/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:c})}),n=await e.json();x(n.error?null:n),p(n.error||""),u(!1)}return((0,s.useEffect)(()=>{e&&f()},[e]),e)?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("h1",{className:"admin-title text-2xl font-bold",children:"Gestione Utenti"}),(0,n.jsx)("button",{onClick:async()=>{let n=await fetch("https://agw.franklin19.workers.dev/api/admin/user/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),s=await n.json();s.error?alert("Error creating user: "+s.error):window.location.href=`/admin/users/${s.id}/edit?token=${e}`},className:"admin-btn admin-btn-gold",children:"+ Create New User"}),(0,n.jsx)(r,{users:i,token:e}),(0,n.jsxs)("div",{className:"admin-card space-y-4",children:[(0,n.jsx)("p",{className:"admin-muted",children:"Cerca utente per ID:"}),(0,n.jsx)("input",{className:"admin-input",value:c,onChange:e=>o(e.target.value)}),(0,n.jsx)("button",{onClick:g,className:"admin-btn admin-btn-gold",children:m?"Ricerca...":"Cerca"}),j&&(0,n.jsx)("p",{className:"admin-muted",children:j})]}),h&&(0,n.jsx)("div",{className:"admin-card",children:(0,n.jsx)("p",{className:"admin-title",children:"User loaded"})})]}):(0,n.jsx)("p",{className:"admin-muted",children:"Token mancante!"})}e.s(["default",()=>x],51364)}]);