module.exports=[47468,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);function e(a){if(!a||Number.isNaN(a))return"—";try{return new Date(a).toLocaleDateString("it-IT")}catch{return"—"}}function f({users:a,token:d}){let[f,j]=(0,c.useState)(""),[m,n]=(0,c.useState)([]);if(!d)return(0,b.jsxs)("div",{className:"admin-card p-6 text-red-500 font-bold",children:["ERRORE: Token amministratore mancante.",(0,b.jsx)("br",{}),"Accedi tramite /admin/login oppure apri:",(0,b.jsx)("br",{}),"/admin/users?token=IL_TUO_TOKEN"]});function o(a){return a?String(a).toLowerCase():""}let p=(Array.isArray(a)?a:[]).filter(a=>{let b=f.toLowerCase();return o(a.id).includes(b)||o(a.nickname).includes(b)||o(a.firstname).includes(b)||o(a.lastname).includes(b)||o(a.email).includes(b)||o(a.subscription?.type).includes(b)||o(a.bonus?.award).includes(b)});async function q(){if(confirm(`Eliminare definitivamente ${m.length} utenti?`)){for(let a of m)await fetch("https://agw.franklin19.workers.dev/api/admin/user/update",{method:"POST",headers:{"Content-Type":"application/json","x-admin-token":d},body:JSON.stringify({token:d,id:a,field:"delete"})});alert("Utenti eliminati correttamente."),window.location.reload()}}return(0,b.jsxs)("div",{className:"admin-card p-4 space-y-4 overflow-auto",children:[(0,b.jsx)("input",{className:"admin-input",placeholder:"Search user (id, name, email, subscription...)",value:f,onChange:a=>j(a.target.value)}),m.length>0&&(0,b.jsxs)("button",{onClick:q,className:"admin-btn admin-btn-danger",children:["Delete Selected (",m.length,")"]}),(0,b.jsx)("div",{className:"overflow-auto",children:(0,b.jsxs)("table",{className:"min-w-full text-sm text-left border-collapse",children:[(0,b.jsx)("thead",{className:"bg-[var(--admin-surface-light)]",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)(g,{children:(0,b.jsx)("input",{type:"checkbox",checked:m.length===p.length&&p.length>0,onChange:function(){m.length===p.length?n([]):n(p.map(a=>a.id))}})}),(0,b.jsx)(g,{children:"Avatar"}),(0,b.jsx)(g,{children:"Edit"}),(0,b.jsx)(g,{children:"Delete"}),(0,b.jsx)(g,{children:"ID"}),(0,b.jsx)(g,{children:"Nickname"}),(0,b.jsx)(g,{children:"Name"}),(0,b.jsx)(g,{children:"Email"}),(0,b.jsx)(g,{children:"Birth"}),(0,b.jsx)(g,{children:"Gender"}),(0,b.jsx)(g,{children:"Height"}),(0,b.jsx)(g,{children:"Weight"}),(0,b.jsx)(g,{children:"Job"}),(0,b.jsx)(g,{children:"Status"}),(0,b.jsx)(g,{children:"Created"}),(0,b.jsx)(g,{children:"Level"}),(0,b.jsx)(g,{children:"Level Y"}),(0,b.jsx)(g,{children:"Rank M"}),(0,b.jsx)(g,{children:"Mot W"}),(0,b.jsx)(g,{children:"Ass D"}),(0,b.jsx)(g,{children:"KRM Tot"}),(0,b.jsx)(g,{children:"KRM Y"}),(0,b.jsx)(g,{children:"KRM M"}),(0,b.jsx)(g,{children:"KRM W"}),(0,b.jsx)(g,{children:"KRM D"}),(0,b.jsx)(g,{children:"Subscription"}),(0,b.jsx)(g,{children:"Pay Status"}),(0,b.jsx)(g,{children:"Payment Date"}),(0,b.jsx)(g,{children:"Expires"}),(0,b.jsx)(g,{children:"Bonus"}),(0,b.jsx)(g,{children:"Bonus Exp"}),(0,b.jsx)(g,{children:"Daily"}),(0,b.jsx)(g,{children:"Weekly"}),(0,b.jsx)(g,{children:"Missions Tot"}),(0,b.jsx)(g,{children:"Missions M"}),(0,b.jsx)(g,{children:"Missions W"}),(0,b.jsx)(g,{children:"Missions T"}),(0,b.jsx)(g,{children:"Last MS"})]})}),(0,b.jsx)("tbody",{children:p.map(a=>(0,b.jsxs)("tr",{className:"border-b border-[var(--admin-border)]",children:[(0,b.jsx)(h,{children:(0,b.jsx)("input",{type:"checkbox",checked:m.includes(a.id),onChange:()=>{var b;return b=a.id,void n(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])}})}),(0,b.jsx)(h,{children:(0,b.jsx)(i,{user:a})}),(0,b.jsx)(h,{children:(0,b.jsx)("a",{href:`/admin/users/${a.id}/edit?token=${d}`,className:"admin-btn admin-btn-blue text-xs",children:"Edit"})}),(0,b.jsx)(h,{children:(0,b.jsx)("button",{onClick:async()=>{if(!confirm(`Eliminare definitivamente l'utente ${a.nickname}?`))return;let b=await fetch("https://agw.franklin19.workers.dev/api/admin/user/update",{method:"POST",headers:{"Content-Type":"application/json","x-admin-token":d},body:JSON.stringify({token:d,id:a.id,field:"delete"})}),c=await b.json();c.deleted?(alert("Utente eliminato."),window.location.reload()):alert("Errore eliminazione: "+(c.error??""))},className:"admin-btn admin-btn-danger text-xs",children:"Delete"})}),(0,b.jsx)(h,{children:a.id}),(0,b.jsx)(h,{children:a.nickname}),(0,b.jsxs)(h,{children:[a.firstname," ",a.lastname]}),(0,b.jsx)(h,{children:a.mailing?.primary}),(0,b.jsx)(h,{children:a.personal?.birthdate}),(0,b.jsx)(h,{children:a.personal?.gender}),(0,b.jsx)(h,{children:a.personal?.height}),(0,b.jsx)(h,{children:a.personal?.weight}),(0,b.jsx)(h,{children:a.personal?.job}),(0,b.jsx)(h,{children:a.status?.suspended?"Suspended":"Active"}),(0,b.jsx)(h,{children:new Date(a.status?.createdAt).toLocaleDateString()}),(0,b.jsx)(h,{children:a.stats?.level_total}),(0,b.jsx)(h,{children:a.stats?.level_year}),(0,b.jsx)(h,{children:a.stats?.rank_month}),(0,b.jsx)(h,{children:a.stats?.motivation_week}),(0,b.jsx)(h,{children:a.stats?.assessment_day}),(0,b.jsx)(h,{children:a.stats?.krm_total}),(0,b.jsx)(h,{children:a.stats?.krm_year}),(0,b.jsx)(h,{children:a.stats?.krm_month}),(0,b.jsx)(h,{children:a.stats?.krm_week}),(0,b.jsx)(h,{children:a.stats?.krm_day}),(0,b.jsx)(h,{children:a.subscription?.type}),(0,b.jsx)(h,{children:(0,b.jsx)(k,{status:a.subscription?.payment_status})}),(0,b.jsx)(h,{children:e(a.subscription?.last_payment_at)}),(0,b.jsx)(h,{children:e(a.subscription?.expires_at)}),(0,b.jsx)(h,{children:a.bonus?.award}),(0,b.jsx)(h,{children:e(a.bonus?.expiresAt)}),(0,b.jsxs)(h,{children:[a.discipline?.daily_completed,"/",a.discipline?.daily_goal]}),(0,b.jsxs)(h,{children:[a.discipline?.weekly_completed,"/",a.discipline?.weekly_goal]}),(0,b.jsx)(h,{children:a.stats?.missions_completed_total}),(0,b.jsx)(h,{children:a.stats?.missions_completed_month}),(0,b.jsx)(h,{children:a.stats?.missions_completed_week}),(0,b.jsx)(h,{children:a.stats?.missions_completed_today}),(0,b.jsx)(h,{children:(0,b.jsx)(l,{missions:a.missions})})]},String(a.id||a.index)))})]})})]})}function g({children:a}){return(0,b.jsx)("th",{className:"px-3 py-2 font-semibold text-[var(--admin-gold)] whitespace-nowrap",children:a})}function h({children:a}){return(0,b.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:a})}function i({user:a}){let c=a.profile_image||a.avatar_ai||"/default-avatar.png";return(0,b.jsx)("img",{src:c,className:"w-10 h-10 rounded-full object-cover border border-[var(--admin-border)]"})}let j=["green","orange","red"];function k({status:a}){let c=j.includes(a)?({green:"text-green-400",orange:"text-orange-400",red:"text-red-400"})[a]:"text-neutral-400";return(0,b.jsx)("span",{className:c,children:a})}function l({missions:a}){if(!a||0===a.length)return(0,b.jsx)("span",{className:"text-neutral-400",children:"—"});let c=a[a.length-1].status;return(0,b.jsx)("span",{className:{approved:"text-green-400",pending:"text-orange-400",rejected:"text-red-400"}[c]??"text-neutral-400",children:c})}function m(){let a=(0,d.useSearchParams)().get("token"),[e,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)("");async function r(){let b=await fetch("https://agw.franklin19.workers.dev/api/admin/users/list",{headers:{"x-admin-token":a??""}}),c=await b.json();c.error||g(c.users)}async function s(){if(!j)return;o(!0),q("");let a=await fetch("https://agw.franklin19.workers.dev/api/user/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:j})}),b=await a.json();m(b.error?null:b),q(b.error||""),o(!1)}return((0,c.useEffect)(()=>{a&&r()},[a]),a)?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("h1",{className:"admin-title text-2xl font-bold",children:"Gestione Utenti"}),(0,b.jsx)("button",{onClick:async()=>{let b=await fetch("https://agw.franklin19.workers.dev/api/admin/user/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a})}),c=await b.json();c.error?alert("Error creating user: "+c.error):window.location.href=`/admin/users/${c.id}/edit?token=${a}`},className:"admin-btn admin-btn-gold",children:"+ Create New User"}),(0,b.jsx)(f,{users:e,token:a}),(0,b.jsxs)("div",{className:"admin-card space-y-4",children:[(0,b.jsx)("p",{className:"admin-muted",children:"Cerca utente per ID:"}),(0,b.jsx)("input",{className:"admin-input",value:j,onChange:a=>k(a.target.value)}),(0,b.jsx)("button",{onClick:s,className:"admin-btn admin-btn-gold",children:n?"Ricerca...":"Cerca"}),p&&(0,b.jsx)("p",{className:"admin-muted",children:p})]}),l&&(0,b.jsx)("div",{className:"admin-card",children:(0,b.jsx)("p",{className:"admin-title",children:"User loaded"})})]}):(0,b.jsx)("p",{className:"admin-muted",children:"Token mancante!"})}a.s(["default",()=>m],47468)}];

//# sourceMappingURL=app_admin_users_page_tsx_4f85054f._.js.map